{"version":3,"sources":["index.es6"],"names":["createInstance","JDBC","jinst","async","path","util","_","SqlFormatter","QueryExpression","QueryField","TraceUtils","SqlUtils","isJvmCreated","addOption","setupClasspath","resolve","__dirname","H2Adapter","options","rawConnection","isNil","Error","getOptions","result","url","format","minpoolsize","maxpoolsize","pool","properties","user","password","host","host_","port","database","callback","self","pools","connectionPool","hasOwnProperty","reserve","err","connObj","initialize","release","console","log","fn","open","transaction_","call","conn","setAutoCommit","error","rollback","commit","e","batch","entity","attribute","migration","appliesTo","model","description","version","add","name","type","primary","size","migrate","execute","length","q","create","select","max","value","parseInt","id","insertId","query","values","sql","formatter","H2Formatter","settings","nameFormat","NAME_FORMAT","startTime","process","env","NODE_ENV","Date","getTime","str","prepare","createStatement","statement","executeQuery","test","executeUpdate","JSON","stringify","toObjArray","results","view","obj","db","waterfall","cb","table","exists","arg","nullable","count","isArray","remove","change","column","newType","oldType","findColumnFunc","find","x","columns","i","bind","splice","type1","replace","push","targetTable","constraints","tableForeignKeys","foreignKeys","eachSeries","constraint","constraintCallback","foreignKeyField","primaryKeyTable","primaryKeyField","indexes","tableIndexes","index","indexCallback","fields","strFields","filter","oneToMany","map","join","strPKFields","strTable","escapeName","owner","matches","exec","drop","undefined","thisArg","executeInTransaction","tr","list","forEach","ix","y","indexName","columnName","cols","apply","sqlCreateIndex","nCols","indexOf","foreignKeyColumn","primaryKeyColumn","foreignKeyName","formatType","field","scale","s","getTimezone_","offset","getTimezoneOffset","zeroPad","Math","floor","number","res","toString","forceAlias","unquoted","escape","escapeDate","$name","valueOf","val","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","datetime","timezone","concat","p0","p1","Object","isNullOrUndefined"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n'use strict';\nimport JDBC from 'jdbc';\nimport jinst from 'jdbc/lib/jinst';\nimport async from 'async';\nimport path from 'path';\nimport util from 'util';\nimport {_} from 'lodash';\nimport {SqlFormatter} from '@themost/query/formatter';\nimport {QueryExpression,QueryField} from \"@themost/query/query\";\nimport {TraceUtils} from \"themost/common/utils\";\nimport {SqlUtils} from '@themost/query/utils';\n\n\nif (!jinst.isJvmCreated()) {\n    jinst.addOption(\"-Xrs\");\n    jinst.setupClasspath([ path.resolve(__dirname, './drivers/h2-latest.jar')]);\n}\n\n\n/**\n * @class\n * @augments DataAdapter\n */\nexport class H2Adapter {\n    /**\n     * @constructor\n     * @param {*} options\n     */\n    constructor(options) {\n        /**\n         * @private\n         * @type {Connection}\n         */\n        this.rawConnection = null;\n\n        if (_.isNil(options)) {\n            throw new Error(\"Data adapter options may not be empty.\");\n        }\n\n        this.getOptions = function() {\n            let result;\n            //build URL\n            if (typeof options.path === 'string') {\n                result = {\n                    url : util.format(\"jdbc:h2:%s;AUTO_SERVER=true;AUTO_RECONNECT=true\", options.path),\n                    minpoolsize:1,\n                    maxpoolsize: typeof options.pool === 'number' ? options.pool : 25,\n                    properties : {\n                        \"user\" : options.user,\n                        \"password\": options.password\n                    }\n                };\n                return result;\n            }\n            else if (typeof options.host === 'string') {\n                const host_ = options.port ? options.host + \":\" + options.port : options.host;\n                result = {\n                    url : util.format(\"jdbc:h2:tcp://%s/%s;AUTO_RECONNECT=true\", host_, options.database),\n                    minpoolsize:1,\n                    maxpoolsize: typeof options.pool === 'number' ? options.pool : 25,\n                    properties : {\n                        \"user\" : options.user,\n                        \"password\": options.password\n                    }\n                };\n                return result;\n            }\n            else {\n                throw new Error(\"Database path or host may not be empty.\");\n            }\n        };\n\n    }\n\n    /**\n     * Opens database connection\n     */\n    open(callback) {\n        callback = callback || function() {};\n        const self = this;\n        if (self.rawConnection) {\n            return callback();\n        }\n        H2Adapter.pools = H2Adapter.pools || { };\n\n        //get connection options\n        const options = this.getOptions();\n\n        let connectionPool;\n        if (H2Adapter.pools.hasOwnProperty(options.url)) {\n            connectionPool=H2Adapter.pools[options.url];\n            connectionPool.reserve(function(err, connObj) {\n                if (err) { return callback(err); }\n                self.rawConnection = connObj;\n                return callback();\n            });\n        }\n        else {\n            connectionPool = new JDBC(self.getOptions());\n            H2Adapter.pools[options.url] = connectionPool;\n            connectionPool.initialize(function(err) {\n                if (err) { return callback(err); }\n                connectionPool.reserve(function(err, connObj) {\n                    if (err) { return callback(err); }\n                    self.rawConnection = connObj;\n                    return callback();\n                });\n            });\n        }\n    }\n\n    /**\n     * @param {function(Error=)} callback\n     */\n    close(callback) {\n        const self = this;\n        callback = callback || function() {};\n        if (typeof self.rawConnection === 'undefined' || self.rawConnection === null) {\n            return callback();\n        }\n        H2Adapter.pools = H2Adapter.pools || { };\n        const options = this.getOptions(), connectionPool=H2Adapter.pools[options.url];\n        if (typeof connectionPool === 'undefined' || connectionPool === null) {\n            return callback(new Error(\"Connection pool may not be empty at this context.\"));\n        }\n        connectionPool.release(self.rawConnection, function(err) {\n            if (err) {\n                console.log(err);\n            }\n            self.rawConnection=null;\n            return callback();\n        });\n    }\n\n    /**\n     * Begins a data transaction and executes the given function\n     * @param fn {Function}\n     * @param callback {Function}\n     */\n    executeInTransaction(fn, callback) {\n        const self = this;\n        //ensure callback\n        callback = callback || function () {};\n        //ensure that database connection is open\n        self.open(function(err) {\n            if (err) {\n                return callback(err);\n            }\n            //execution is already in transaction\n            if (self.transaction_) {\n                //so invoke method\n                fn.call(self, function(err)\n                {\n                    //call callback\n                    return callback(err);\n                });\n            }\n            else {\n                //set auto commit to off\n                return self.rawConnection.conn.setAutoCommit(false, function() {\n                    if (err) { return callback(err); }\n                    //set savepoint\n                    self.transaction_ = true;\n                    try {\n                        //invoke method\n                        fn.call(self, function(error)\n                        {\n                            if (error) {\n                                self.rawConnection.conn.rollback(function(err) {\n                                    if (err) {\n                                        //log transaction rollback error\n                                        util.log(\"An error occured while rolling back savepoint.\");\n                                        util.log(err);\n                                    }\n                                    delete self.transaction_;\n                                    return self.rawConnection.conn.setAutoCommit(true, function() {\n                                        return callback(error);\n                                    });\n                                });\n                            }\n                            else {\n                                self.rawConnection.conn.commit(function(err) {\n                                    delete self.transaction_;\n                                    return self.rawConnection.conn.setAutoCommit(true, function() {\n                                        return callback(err);\n                                    });\n                                });\n                            }\n                        });\n                    }\n                    catch(e) {\n                        self.rawConnection.conn.rollback(function(err) {\n                            if (err) {\n                                //log transaction rollback error\n                                util.log(\"An error occured while rolling back savepoint.\");\n                                util.log(err);\n                            }\n                            delete self.transaction_;\n                            return self.rawConnection.conn.setAutoCommit(true, function() {\n                                return callback(e);\n                            });\n                        });\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * Executes an operation against database and returns the results.\n     * @param batch {*}\n     * @param callback {Function}\n     */\n    executeBatch(batch, callback) {\n        callback = callback || function() {};\n        callback(new Error('DataAdapter.executeBatch() is obsolete. Use DataAdapter.executeInTransaction() instead.'));\n    }\n\n    /**\n     * Produces a new identity value for the given entity and attribute.\n     * @param entity {String} The target entity name\n     * @param attribute {String} The target attribute\n     * @param callback {Function=}\n     */\n    selectIdentity(entity, attribute, callback) {\n\n        const self = this;\n\n        const migration = {\n            appliesTo:'increment_id',\n            model:'increments',\n            description:'Increments migration (version 1.0)',\n            version:'1.0',\n            add:[\n                { name:'id', type:'Counter', primary:true },\n                { name:'entity', type:'Text', size:120 },\n                { name:'attribute', type:'Text', size:120 },\n                { name:'value', type:'Integer' }\n            ]\n        };\n        //ensure increments entity\n        self.migrate(migration, function(err)\n        {\n            //throw error if any\n            if (err) { callback.call(self,err); return; }\n\n            self.execute('SELECT * FROM \"increment_id\" WHERE \"entity\"=? AND \"attribute\"=?', [entity, attribute], function(err, result) {\n                if (err) { callback.call(self,err); return; }\n                if (result.length===0) {\n                    //get max value by querying the given entity\n                    const q = QueryExpression.create(entity).select(QueryField.create().max(attribute));\n                    self.execute(q,null, function(err, result) {\n                        if (err) { callback.call(self, err); return; }\n                        let value = 1;\n                        if (result.length>0) {\n                            value = parseInt(result[0][attribute]) + 1;\n                        }\n                        self.execute('INSERT INTO \"increment_id\"(\"entity\", \"attribute\", \"value\") VALUES (?,?,?)',[entity, attribute, value], function(err) {\n                            //throw error if any\n                            if (err) { callback.call(self, err); return; }\n                            //return new increment value\n                            callback.call(self, err, value);\n                        });\n                    });\n                }\n                else {\n                    //get new increment value\n                    const value = parseInt(result[0].value) + 1;\n                    self.execute('UPDATE \"increment_id\" SET \"value\"=? WHERE \"id\"=?',[value, result[0].id], function(err) {\n                        //throw error if any\n                        if (err) { callback.call(self, err); return; }\n                        //return new increment value\n                        callback.call(self, err, value);\n                    });\n                }\n            });\n        });\n    }\n\n    lastIdentity(callback) {\n        const self = this;\n        self.open(function(err) {\n            if (err) {\n                callback(err);\n            }\n            else {\n                self.execute('SELECT SCOPE_IDENTITY() as \"lastval\"', [], function(err, result) {\n                    if (err) {\n                        callback(null, { insertId: null });\n                    }\n                    else {\n                        result = result || [];\n                        if (result.length>0)\n                            callback(null, { insertId:parseInt(result[0][\"lastval\"]) });\n                        else\n                            callback(null, { insertId: null });\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * @param query {*}\n     * @param values {*}\n     * @param {function} callback\n     */\n    execute(query, values, callback) {\n        const self = this;\n        let sql = null;\n        try {\n\n            if (typeof query === 'string') {\n                sql = query;\n            }\n            else {\n                //format query expression or any object that may be act as query expression\n                const formatter = new H2Formatter();\n                formatter.settings.nameFormat = H2Adapter.NAME_FORMAT;\n                sql = formatter.format(query);\n            }\n            //validate sql statement\n            if (typeof sql !== 'string') {\n                callback.call(self, new Error('The executing command is of the wrong type or empty.'));\n                return;\n            }\n            //ensure connection\n            self.open(function(err) {\n                if (err) {\n                    callback.call(self, err);\n                }\n                else {\n\n                    let startTime;\n                    if (process.env.NODE_ENV==='development') {\n                        startTime = new Date().getTime();\n                    }\n                    //execute raw command\n                    const str = SqlUtils.prepare(sql, values);\n                    self.rawConnection.conn.createStatement(function(err, statement) {\n                        if (err) { return callback(err); }\n                        let executeQuery = statement.executeQuery;\n                        if (!/^SELECT/i.test(str)) {\n                            executeQuery = statement.executeUpdate;\n                        }\n                        executeQuery.call(statement, str, function(err, result) {\n                            if (process.env.NODE_ENV==='development') {\n                                console.log(util.format('SQL (Execution Time:%sms):%s, Parameters:%s', (new Date()).getTime()-startTime, sql, JSON.stringify(values)));\n                            }\n                            if (err) {\n                                return callback(err);\n                            }\n                            if (typeof result.toObjArray === 'function') {\n                                result.toObjArray(function(err, results) {\n                                    return callback(null, results);\n                                });\n                            }\n                            else {\n                                return callback(null, result);\n                            }\n                        });\n                    });\n                }\n            });\n        }\n        catch (e) {\n            callback.call(self, e);\n        }\n    }\n\n    /**\n     * Formats an object based on the format string provided. Valid formats are:\n     * %t : Formats a field and returns field type definition\n     * %f : Formats a field and returns field name\n     * @param format {string}\n     * @param obj {*}\n     */\n    static format(format, obj) {\n        let result = format;\n        if (/%t/.test(format))\n            result = result.replace(/%t/g,H2Adapter.formatType(obj));\n        if (/%f/.test(format))\n            result = result.replace(/%f/g,obj.name);\n        return result;\n    }\n\n    static formatType(field) {\n        const size = parseInt(field.size);\n        const scale = parseInt(field.scale);\n        let s = 'VARCHAR(512) NULL';\n        const type=field.type;\n        switch (type)\n        {\n            case 'Boolean':\n                s = 'BOOLEAN';\n                break;\n            case 'Byte':\n                s = 'TINYINT';\n                break;\n            case 'Number':\n            case 'Float':\n                s = 'REAL';\n                break;\n            case 'Counter':\n                return 'INT AUTO_INCREMENT NOT NULL';\n            case 'Currency':\n                s =  'DECIMAL(19,4)';\n                break;\n            case 'Decimal':\n                s =  util.format('DECIMAL(%s,%s)', (size>0 ? size : 19),(scale>0 ? scale : 8));\n                break;\n            case 'Date':\n                s = 'DATE';\n                break;\n            case 'DateTime':\n                s = 'TIMESTAMP';\n                break;\n            case 'Time':\n                s = 'TIME';\n                break;\n            case 'Integer':\n                s = 'INTEGER';\n                break;\n            case 'Duration':\n                s = size>0 ?  util.format('VARCHAR(%s)', size) : 'VARCHAR(36)';\n                break;\n            case 'BigInteger':\n                s = 'BIGINT';\n                break;\n            case 'URL':\n                s = size>0 ?  util.format('VARCHAR(%s)', size) : 'VARCHAR(512)';\n                break;\n            case 'Text':\n                s = size>0 ?  util.format('VARCHAR(%s)', size) : 'VARCHAR(512)';\n                break;\n            case 'Note':\n                s = size>0 ?  util.format('VARCHAR(%s)', size) : 'CLOB';\n                break;\n            case 'Image':\n            case 'Binary':\n                s = size > 0 ? util.format('BLOB(%s)', size) : 'BLOB';\n                break;\n            case 'Guid':\n                s = 'VARCHAR(36)';\n                break;\n            case 'Short':\n                s = 'SMALLINT';\n                break;\n            default:\n                s = 'INTEGER';\n                break;\n        }\n        s += typeof (field.nullable=== 'undefined') ? ' null': (field.nullable===true || field.nullable === 1) ? ' NULL': ' NOT NULL';\n        return s;\n    }\n\n    /**\n     * @param {string} name\n     * @param {QueryExpression} query\n     * @param {function(Error=)} callback\n     */\n    createView(name, query, callback) {\n        this.view(name).create(query, callback);\n    }\n\n    /**\n     *\n     * @param  {DataModelMigration|*} obj - An Object that represents the data model scheme we want to migrate\n     * @param {function(Error=,*=)} callback\n     */\n    migrate(obj, callback) {\n        if (obj===null)\n            return;\n        const self = this;\n        const migration = obj;\n        if (migration.appliesTo===null)\n            throw new Error(\"Model name is undefined\");\n        self.open(function(err) {\n            if (err) {\n                callback.call(self, err);\n            }\n            else {\n                const db = self.rawConnection;\n                async.waterfall([\n                    //1. Check migrations table existence\n                    function(cb) {\n                        self.table('migrations').exists(function(err, exists) {\n                            if (err) { return cb(err); }\n                            cb(null, exists);\n                        });\n                    },\n                    //2. Create migrations table if not exists\n                    function(arg, cb) {\n                        if (arg>0) { return cb(null, 0); }\n                        self.table('migrations').create([\n                            { name:'id', type:'Counter', primary:true, nullable:false  },\n                            { name:'appliesTo', type:'Text', size:'80', nullable:false  },\n                            { name:'model', type:'Text', size:'120', nullable:true  },\n                            { name:'description', type:'Text', size:'512', nullable:true  },\n                            { name:'version', type:'Text', size:'40', nullable:false  }\n                        ], function(err) {\n                            if (err) { return cb(err); }\n                            cb(null,0);\n                        });\n                    },\n                    //3. Check if migration has already been applied\n                    function(arg, cb) {\n                        self.execute('SELECT COUNT(*) AS \"count\" FROM \"migrations\" WHERE \"appliesTo\"=? and \"version\"=?',\n                            [migration.appliesTo, migration.version], function(err, result) {\n                                if (err) { return cb(err); }\n                                cb(null, result[0].count);\n                            });\n                    },\n                    //4a. Check table existence\n                    function(arg, cb) {\n                        //migration has already been applied (set migration.updated=true)\n                        if (arg>0) { obj['updated']=true; cb(null, -1); return; }\n                        self.table(migration.appliesTo).exists(function(err, exists) {\n                            if (err) { return cb(err); }\n                            cb(null, exists);\n                        });\n                    },\n                    //4b. Migrate target table (create or alter)\n                    function(arg, cb) {\n                        //migration has already been applied\n                        if (arg<0) { return cb(null, arg); }\n                        if (arg===0) {\n                            //create table\n                            return self.table(migration.appliesTo).create(migration.add, function(err) {\n                                if (err) { return cb(err); }\n                                cb(null, 1);\n                            });\n                        }\n                        //columns to be removed (unsupported)\n                        if (util.isArray(migration.remove)) {\n                            if (migration.remove.length>0) {\n                                return cb(new Error('Data migration remove operation is not supported by this adapter.'));\n                            }\n                        }\n                        //columns to be changed (unsupported)\n                        if (util.isArray(migration.change)) {\n                            if (migration.change.length>0) {\n                                return cb(new Error('Data migration change operation is not supported by this adapter. Use add collection instead.'));\n                            }\n                        }\n                        let column, newType, oldType;\n                        const findColumnFunc = (name) => {\n                          return _.find(this, (x)=> {\n                              return (name===x.name);\n                          });\n                        };\n                        if (util.isArray(migration.add)) {\n                            //init change collection\n                            migration.change = [];\n                            //get table columns\n                            self.table(migration.appliesTo).columns(function(err, columns) {\n                                if (err) { return cb(err); }\n                                for (let i = 0; i < migration.add.length; i++) {\n                                    const x = migration.add[i];\n                                    column = findColumnFunc.bind(columns)(x.name);\n                                    if (column) {\n                                        //if column is primary key remove it from collection\n                                        if (column.primary) {\n                                            migration.add.splice(i, 1);\n                                            i-=1;\n                                        }\n                                        else {\n                                            //get new type\n                                            newType = H2Adapter.format('%t', x);\n                                            //get old type\n                                            oldType = column.type1.replace(/\\s+$/,'') + ((column.nullable===true || column.nullable === 1) ? ' NULL' : ' NOT NULL');\n                                            //remove column from collection\n                                            migration.add.splice(i, 1);\n                                            i-=1;\n                                            if (newType !== oldType) {\n                                                //add column to alter collection\n                                                migration.change.push(x);\n                                            }\n                                        }\n                                    }\n                                }\n                                //alter table\n                                const targetTable = self.table(migration.appliesTo);\n                                //add new columns (if any)\n                                targetTable.add(migration.add, function(err) {\n                                    if (err) { return cb(err); }\n                                    //modify columns (if any)\n                                    targetTable.change(migration.change, function(err) {\n                                        if (err) { return cb(err); }\n                                        cb(null, 1);\n                                    });\n                                });\n                            });\n                        }\n                        else {\n                            cb(new Error('Invalid migration data.'));\n                        }\n                    },\n                    //Apply data model foreign keys\n                    function (arg, cb) {\n                        if (arg<=0) { return cb(null, arg); }\n                        if (migration.constraints) {\n                            const tableForeignKeys = self.foreignKeys(migration.appliesTo);\n                            //enumerate migration constraints\n                            async.eachSeries(migration.constraints, function(constraint, constraintCallback) {\n                                //if constraint is a foreign key constraint\n                                if (constraint.type === 'foreignKey') {\n                                    //create table foreign key\n                                    return tableForeignKeys.create(constraint.foreignKeyField,\n                                        constraint.primaryKeyTable,\n                                        constraint.primaryKeyField,\n                                        constraintCallback);\n                                }\n                                else {\n                                    //else do nothing\n                                    return constraintCallback();\n                                }\n                            }, function(err) {\n                                //throw error\n                                if (err) { return cb(err); }\n                                //or return success flag\n                                return cb(null, 1);\n                            });\n                        }\n                        else {\n                            //do nothing and exit\n                            return cb(null, 1);\n                        }\n                    },\n                    //Apply data model indexes\n                    function (arg, cb) {\n                        if (arg<=0) { return cb(null, arg); }\n                        if (migration.indexes) {\n                            const tableIndexes = self.indexes(migration.appliesTo);\n                            //enumerate migration constraints\n                            async.eachSeries(migration.indexes, function(index, indexCallback) {\n                                tableIndexes.create(index.name, index.columns, indexCallback);\n                            }, function(err) {\n                                //throw error\n                                if (err) { return cb(err); }\n                                //or return success flag\n                                return cb(null, 1);\n                            });\n                        }\n                        else {\n                            //do nothing and exit\n                            return cb(null, 1);\n                        }\n                    }, function(arg, cb) {\n                        if (arg>0) {\n                            //log migration to database\n                            self.execute('INSERT INTO \"migrations\" (\"appliesTo\",\"model\",\"version\",\"description\") VALUES (?,?,?,?)', [migration.appliesTo,\n                                migration.model,\n                                migration.version,\n                                migration.description ], function(err) {\n                                if (err) { return cb(err); }\n                                return cb(null, 1);\n                            });\n                        }\n                        else\n                            cb(null, arg);\n\n                    }\n                ], function(err, result) {\n                    callback(err, result);\n                });\n            }\n        });\n    }\n\n    table(name) {\n        const self = this;\n\n        return {\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            exists:function(callback) {\n                callback = callback || function() {};\n                self.execute('SELECT COUNT(*) AS \"count\" FROM information_schema.TABLES WHERE TABLE_NAME=? AND TABLE_SCHEMA=?',\n                    [ name, 'PUBLIC' ], function(err, result) {\n                        if (err) { return callback(err); }\n                        callback(null, result[0].count);\n                    });\n            },\n            /**\n             * @param {function(Error,string=)} callback\n             */\n            version:function(callback) {\n                callback = callback || function() {};\n                self.execute('SELECT MAX(\"version\") AS \"version\" FROM \"migrations\" WHERE \"appliesTo\"=?',\n                    [name], function(err, result) {\n                        if (err) { return callback(err); }\n                        if (result.length===0)\n                            callback(null, '0.0');\n                        else\n                            callback(null, result[0].version || '0.0');\n                    });\n            },\n            /**\n             * @param {function(Error=,Array=)} callback\n             */\n            columns:function(callback) {\n                callback = callback || function() {};\n                self.execute('SELECT COLUMN_NAME AS \"name\", TYPE_NAME as \"type\",CHARACTER_MAXIMUM_LENGTH as \"size\", ' +\n                'CASE WHEN IS_NULLABLE=\\'YES\\' THEN 1 ELSE 0 END AS \"nullable\", NUMERIC_PRECISION as \"precision\",' +\n                'NUMERIC_SCALE as \"scale\" ,(SELECT COUNT(*) FROM information_schema.INDEXES WHERE TABLE_CATALOG=\"c\".TABLE_CATALOG AND TABLE_SCHEMA=\"c\".TABLE_SCHEMA AND TABLE_NAME=\"c\".TABLE_NAME ' +\n                'AND PRIMARY_KEY=true AND COLUMN_NAME=\"c\".COLUMN_NAME) AS \"primary\" ,CONCAT(TYPE_NAME, (CASE WHEN \"NULLABLE\" = 0 THEN \\' NOT NULL\\' ELSE \\'\\' END)) ' +\n                'AS \"type1\" FROM information_schema.COLUMNS AS \"c\" WHERE TABLE_NAME=? AND TABLE_SCHEMA=?',\n                    [ name, 'PUBLIC' ], function(err, result) {\n                        if (err) { return callback(err); }\n                        callback(null, result);\n                    });\n            },\n            /**\n             * @param {{name:string,type:string,primary:boolean|number,nullable:boolean|number,size:number, scale:number,precision:number,oneToMany:boolean}[]|*} fields\n             * @param callback\n             */\n            create: function(fields, callback) {\n                callback = callback || function() {};\n                fields = fields || [];\n                if (!util.isArray(fields)) {\n                    return callback(new Error('Invalid argument type. Expected Array.'));\n                }\n                if (fields.length === 0) {\n                    return callback(new Error('Invalid argument. Fields collection cannot be empty.'));\n                }\n                let strFields = fields.filter(function(x) {\n                    return !x.oneToMany;\n                }).map(\n                    function(x) {\n                        return H2Adapter.format('\"%f\" %t', x);\n                    }).join(', ');\n                //add primary key constraint\n                const strPKFields = fields.filter(function(x) { return (x.primary === true || x.primary === 1); }).map(function(x) {\n                    return H2Adapter.format('\"%f\"', x);\n                }).join(', ');\n                if (strPKFields.length>0) {\n                    strFields += ', ' + util.format('PRIMARY KEY (%s)', strPKFields);\n                }\n                const sql = util.format('CREATE TABLE \"%s\" (%s)', name, strFields);\n                self.execute(sql, null, function(err) {\n                    callback(err);\n                });\n            },\n            /**\n             * Alters the table by adding an array of fields\n             * @param {{name:string,type:string,primary:boolean|number,nullable:boolean|number,size:number,oneToMany:boolean}[]|*} fields\n             * @param callback\n             */\n            add:function(fields, callback) {\n                callback = callback || function() {};\n                callback = callback || function() {};\n                fields = fields || [];\n                if (!util.isArray(fields)) {\n                    //invalid argument exception\n                    return callback(new Error('Invalid argument type. Expected Array.'));\n                }\n                if (fields.length === 0) {\n                    //do nothing\n                    return callback();\n                }\n                const formatter = new H2Formatter();\n                const strTable = formatter.escapeName(name);\n                //generate SQL statement\n                const sql = fields.map(function(x) {\n                    return H2Adapter.format('ALTER TABLE ' + strTable + ' ADD \"%f\" %t', x);\n                }).join(';');\n                self.execute(sql, [], function(err) {\n                    callback(err);\n                });\n            },\n            /**\n             * Alters the table by modifying an array of fields\n             * @param {{name:string,type:string,primary:boolean|number,nullable:boolean|number,size:number,oneToMany:boolean}[]|*} fields\n             * @param callback\n             */\n            change:function(fields, callback) {\n                callback = callback || function() {};\n                callback = callback || function() {};\n                fields = fields || [];\n                if (!util.isArray(fields)) {\n                    //invalid argument exception\n                    return callback(new Error('Invalid argument type. Expected Array.'));\n                }\n                if (fields.length === 0) {\n                    //do nothing\n                    return callback();\n                }\n                const formatter = new H2Formatter();\n                const strTable = formatter.escapeName(name);\n                //generate SQL statement\n                const sql = fields.map(function(x) {\n                    return H2Adapter.format('ALTER TABLE ' + strTable + ' ALTER COLUMN \"%f\" %t', x);\n                }).join(';');\n                self.execute(sql, [], function(err) {\n                    callback(err);\n                });\n            }\n        };\n    }\n\n    view(name) {\n        const self = this;\n        let owner;\n        let view;\n\n        const matches = /(\\w+)\\.(\\w+)/.exec(name);\n        if (matches) {\n            //get schema owner\n            owner = matches[1];\n            //get table name\n            view = matches[2];\n        }\n        else {\n            view = name;\n        }\n        return {\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            exists:function(callback) {\n                const sql = 'SELECT COUNT(*) AS \"count\" FROM information_schema.TABLES WHERE TABLE_NAME=? AND TABLE_TYPE=\\'VIEW\\' AND TABLE_SCHEMA=?';\n                self.execute(sql, [name, 'PUBLIC'], function(err, result) {\n                    if (err) { callback(err); return; }\n                    callback(null, (result[0].count>0));\n                });\n            },\n            /**\n             * @param {function(Error=)} callback\n             */\n            drop:function(callback) {\n                callback = callback || function() {};\n                self.open(function(err) {\n                    if (err) { return callback(err); }\n                    const sql = 'SELECT COUNT(*) AS \"count\" FROM information_schema.TABLES WHERE TABLE_NAME=? AND TABLE_TYPE=\\'VIEW\\' AND TABLE_SCHEMA=?';\n                    self.execute(sql, [name, 'PUBLIC'], function(err, result) {\n                        if (err) { return callback(err); }\n                        const exists = (result[0].count>0);\n                        if (exists) {\n                            const sql = util.format('DROP VIEW \"%s\"',name);\n                            self.execute(sql, undefined, function(err) {\n                                if (err) { callback(err); return; }\n                                callback();\n                            });\n                        }\n                        else {\n                            callback();\n                        }\n                    });\n                });\n            },\n            /**\n             * @param {QueryExpression|*} q\n             * @param {function(Error=)} callback\n             */\n            create:function(q, callback) {\n                const thisArg = this;\n                self.executeInTransaction(function(tr) {\n                    thisArg.drop(function(err) {\n                        if (err) { return tr(err); }\n                        try {\n                            let sql = util.format('CREATE VIEW \"%s\" AS ',name);\n                            const formatter = new H2Formatter();\n                            sql += formatter.format(q);\n                            self.execute(sql, [], tr);\n                        }\n                        catch(e) {\n                            tr(e);\n                        }\n                    });\n                }, function(err) {\n                    callback(err);\n                });\n\n            }\n        };\n    }\n\n    indexes(table) {\n      const self = this, formatter = new H2Formatter();\n        return {\n            list: function (callback) {\n                self.execute('SELECT INDEX_NAME as \"indexName\", TABLE_NAME as \"tableName\", COLUMN_NAME as \"columnName\" FROM \"INFORMATION_SCHEMA\".INDEXES ' +\n                    'WHERE TABLE_NAME=? AND TABLE_SCHEMA=? AND INDEX_TYPE_NAME=\\'INDEX\\'', [ table, 'PUBLIC'] , function (err, result) {\n                    if (err) { return callback(err); }\n                    const indexes = [];\n                    result.forEach(function(x) {\n                       const ix = indexes.find(function(y) {\n                          return y.name === x.indexName;\n                       });\n                        if (ix) {\n                            ix.columns.push(x.columnName);\n                        }\n                        else {\n                            indexes.push({\n                                name:x.indexName,\n                                columns: [ x.columnName ]\n                            });\n                        }\n                    });\n                    return callback(null, indexes);\n                });\n            },\n            /**\n             * @param {string} name\n             * @param {Array|string} columns\n             * @param {Function} callback\n             */\n            create: function(name, columns, callback) {\n                const cols = [];\n                if (typeof columns === 'string') {\n                    cols.push(columns);\n                }\n                else if (util.isArray(columns)) {\n                    cols.push.apply(cols, columns);\n                }\n                else {\n                    return callback(new Error(\"Invalid parameter. Columns parameter must be a string or an array of strings.\"));\n                }\n\n                this.list(function(err, indexes) {\n                   if (err) { return callback(err); }\n                   const ix = indexes.find(function(x) { return x.name === name; });\n                    //format create index SQL statement\n                    const sqlCreateIndex = util.format(\"CREATE INDEX %s ON %s(%s)\",\n                        formatter.escapeName(name),\n                        formatter.escapeName(table),\n                        cols.map(function(x) {\n                            return formatter.escapeName(x);\n                        }).join(\",\"));\n                    if (typeof ix === 'undefined' || ix === null) {\n                        self.execute(sqlCreateIndex, [], callback);\n                    }\n                    else {\n                        let nCols = cols.length;\n                        //enumerate existing columns\n                        ix.columns.forEach(function(x) {\n                            if (cols.indexOf(x)>=0) {\n                                //column exists in index\n                                nCols -= 1;\n                            }\n                        });\n                        if (nCols>0) {\n                            //drop index\n                            this.drop(name, function(err) {\n                               if (err) { return callback(err); }\n                               //and create it\n                                self.execute(sqlCreateIndex, [], callback);\n                            });\n                        }\n                        else {\n                            //do nothing\n                            return callback();\n                        }\n                    }\n                });\n\n\n            },\n            drop: function(name, callback) {\n                if (typeof name !== 'string') {\n                    return callback(new Error(\"Name must be a valid string.\"));\n                }\n                self.execute('SELECT COUNT(*) as \"count\" FROM \"INFORMATION_SCHEMA\".INDEXES WHERE  TABLE_NAME=? AND TABLE_SCHEMA=? AND INDEX_NAME=?', [ table, 'PUBLIC', name ], function(err, result) {\n                    if (err) { return callback(err); }\n                    const exists = (result.length>0) && (result[0].count>0);\n                    if (!exists) {\n                        return callback();\n                    }\n                    self.execute(util.format(\"DROP INDEX %s\", self.escapeName(name)), [], callback);\n                });\n            }\n        };\n    }\n\n    foreignKeys(table) {\n      const self = this;\n        return {\n            /**\n             * Gets the collection of the foreign keys associated with the given table\n             * @param callback\n             */\n            list:function (callback) {\n                self.execute('SELECT FK_NAME as \"foreignKeyName\" ,PKTABLE_NAME as \"primaryKeyTable\",PKCOLUMN_NAME as \"primaryKeyColumn\", ' +\n                    'FKTABLE_NAME as \"foreignKeyTable\",FKCOLUMN_NAME as \"foreignKeyColumn\" ' +\n                    'FROM \"INFORMATION_SCHEMA\".CROSS_REFERENCES WHERE FKTABLE_NAME=? AND FKTABLE_SCHEMA=?', [ table, \"PUBLIC\" ], function(err, result) {\n                    if (err) {\n                        return callback(err);\n                    }\n                    return callback(null, result);\n                });\n            },\n            /**\n             * Creates a foreign key association between two tables\n             * @param {string} foreignKeyColumn\n             * @param {string} primaryKeyTable\n             * @param {string} primaryKeyColumn\n             * @param {Function} callback\n             */\n            create:function(foreignKeyColumn, primaryKeyTable, primaryKeyColumn, callback) {\n                self.execute('SELECT COUNT(*) as \"count\" FROM \"INFORMATION_SCHEMA\".CROSS_REFERENCES ' +\n                    'WHERE FKTABLE_NAME=? AND FKTABLE_SCHEMA=? AND FKCOLUMN_NAME=? AND PKTABLE_NAME=? AND PKCOLUMN_NAME=?',\n                    [ table, \"PUBLIC\", foreignKeyColumn, primaryKeyTable, primaryKeyColumn ], function(err, result) {\n                    if (err) {\n                        return callback(err);\n                    }\n                    //if foreign key already exists\n                    if (result[0] && result[0].count>0) {\n                        return callback();\n                    }\n                    const sql = util.format('ALTER TABLE \"%s\" ADD FOREIGN KEY (\"%s\") REFERENCES \"%s\"(\"%s\")', table, foreignKeyColumn, primaryKeyTable, primaryKeyColumn);\n                    self.execute(sql, [], function(err) {\n                        return callback(err);\n                    });\n                });\n            },\n            /**\n             * Drops a foreign key association between two tables\n             * @param {string} foreignKeyColumn\n             * @param {string} primaryKeyTable\n             * @param {string} primaryKeyColumn\n             * @param {Function} callback\n             */\n            drop:function(foreignKeyColumn, primaryKeyTable, primaryKeyColumn, callback) {\n                self.execute('SELECT FK_NAME as \"foreignKeyName\" FROM \"INFORMATION_SCHEMA\".CROSS_REFERENCES ' +\n                    'WHERE FKTABLE_NAME=? AND FKTABLE_SCHEMA=? AND FKCOLUMN_NAME=? AND PKTABLE_NAME=? AND PKCOLUMN_NAME=?',\n                    [ table, \"PUBLIC\", foreignKeyColumn, primaryKeyTable, primaryKeyColumn ], function(err, result) {\n                        if (err) {\n                            return callback(err);\n                        }\n                        if (result[0]) {\n                            const sql = util.format('ALTER TABLE \"%s\" DROP CONSTRAINT \"%s\";', table, result[0].foreignKeyName);\n                            self.execute(sql, [], function(err) {\n                                return callback(err);\n                            });\n                        }\n                        else {\n                            return callback();\n                        }\n                    });\n            }\n        };\n    }\n\n    /**\n     * Gets the database timezone\n     * @param {Function} callback\n     */\n    getDatabaseTimezone(callback) {\n    return this.execute('SELECT FORMATDATETIME(CURRENT_TIMESTAMP(),\\'XXX\\') as \"timezone\"', null, function (err, result) {\n        if (err) { return callback(err); }\n        return callback(null, result[0][\"timezone\"]);\n    });\n}\n\n}\n\n/**\n * @returns {string}\n * @private\n */\nfunction getTimezone_() {\n    const offset = (new Date()).getTimezoneOffset();\n       return (offset<=0 ? '+' : '-') + zeroPad(-Math.floor(offset/60),2) + ':' + zeroPad(offset%60,2);\n}\n\nfunction zeroPad(number, length) {\n    number = number || 0;\n    let res = number.toString();\n    while (res.length < length) {\n        res = '0' + res;\n    }\n    return res;\n}\n\n/**\n * @class\n * @augments {SqlFormatter}\n */\nexport class H2Formatter extends SqlFormatter {\n    /**\n     * @constructor\n     */\n    constructor() {\n        super();\n        this.settings = {\n            nameFormat:H2Formatter.NAME_FORMAT,\n            forceAlias:true\n        };\n    }\n\n    escapeName(name) {\n        if (typeof name === 'string') {\n            if (/^(\\w+)\\.(\\w+)$/g.test(name)) {\n                return name.replace(/(\\w+)/g, H2Formatter.NAME_FORMAT);\n            }\n            return name.replace(/(\\w+)$|^(\\w+)$/g, H2Formatter.NAME_FORMAT);\n        }\n        return name;\n    }\n\n    escape(value, unquoted) {\n        if (value===null || typeof value==='undefined')\n            return SqlUtils.escape(null);\n\n        if(typeof value==='string') {\n            if (unquoted) {\n                return value.replace(/'/g, \"''\");\n            }\n            return '\\'' + value.replace(/'/g, \"''\") + '\\'';\n        }\n\n        if (typeof value==='boolean')\n            return value ? 1 : 0;\n        if (typeof value === 'object')\n        {\n            if (value instanceof Date)\n                return this.escapeDate(value);\n            if (value.hasOwnProperty('$name'))\n                return this.escapeName(value.$name);\n        }\n        if (unquoted)\n            return value.valueOf();\n        else\n            return SqlUtils.escape(value);\n    }\n\n    /**\n     * @param {Date|*} val\n     * @returns {string}\n     */\n    escapeDate(val) {\n        /*\n        Important Note\n        H2 database engine uses server timezone while inserting date values.\n        \n        Tip #1: convert date to GMT: new Date(val.valueOf() + val.getTimezoneOffset() * 60000); \n        */\n        const year   = val.getFullYear();\n        const month  = zeroPad(val.getMonth() + 1, 2);\n        const day    = zeroPad(val.getDate(), 2);\n        const hour   = zeroPad(val.getHours(), 2);\n        const minute = zeroPad(val.getMinutes(), 2);\n        const second = zeroPad(val.getSeconds(), 2);\n        const datetime = year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;\n        const offset = val.getTimezoneOffset(), timezone = (offset<=0 ? '+' : '-') + zeroPad(-Math.floor(offset/60),2) + ':' + zeroPad(offset%60,2);\n        return \"'\" + datetime.concat(timezone) + \"'\";\n    }\n\n    /**\n     * Implements length(a) expression formatter.\n     * @param {*} p0\n     * @returns {string}\n     */\n    $length(p0) {\n        return util.format('LENGTH(%s)', this.escape(p0));\n    }\n\n    $day(p0) {\n        return util.format('DAY_OF_MONTH(%s)', this.escape(p0));\n    }\n\n    $date(p0) {\n        return util.format('CAST(%s AS DATE)', this.escape(p0));\n    }\n\n    $mod(p0, p1) {\n        //validate params\n        if (Object.isNullOrUndefined(p0) || Object.isNullOrUndefined(p1))\n            return '0';\n        return util.format('MOD(%s,%s)', this.escape(p0), this.escape(p1));\n    }\n\n    $bit(p0, p1) {\n        //validate params\n        if (Object.isNullOrUndefined(p0) || Object.isNullOrUndefined(p1))\n            return '0';\n        return util.format('BITAND(%s,%s)', this.escape(p0), this.escape(p1));\n    }\n}\n\nH2Formatter.NAME_FORMAT = '\"$1\"';\n\n/**\n * Creates an instance of H2Adapter object that represents a MySql database connection.\n * @param {*} options An object that represents the properties of the underlying database connection.\n * @returns {DataAdapter}\n */\nexport function createInstance(options) {\n    return new H2Adapter(options);\n}"]}