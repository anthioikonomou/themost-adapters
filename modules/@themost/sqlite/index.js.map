{"version":3,"sources":["index.es6"],"names":["createInstance","async","_","util","SqlFormatter","sqlite","SqlUtils","QueryExpression","QueryField","sqlite3","verbose","SqliteAdapter","options","database","rawConnection","callback","self","Database","err","close","e","console","log","message","query","values","prepare","fn","open","transaction","call","run","undefined","name","view","create","obj","isNil","migration","format","result","test","replace","formatType","waterfall","cb","supportMigrations","table","exists","arg","execute","appliesTo","version","updated","columns","args","strFields","add","filter","x","map","join","sql","expressions","forceAlter","column","newType","oldType","isArray","remove","i","colIndex","findIndex","y","primary","splice","length","change","find","type","toUpperCase","concat","nullable","push","Error","forEach","eachSeries","expr","indexes","tableIndexes","index","indexCallback","model","description","entity","attribute","size","migrate","q","select","max","value","parseInt","id","batch","count","has_sequence","arr","iterator","col","ordinal","cid","notnull","pk","matches","exec","scale","drop","thisArg","executeInTransaction","tr","formatter","SqliteFormatter","process","env","NODE_ENV","JSON","stringify","prepared","all","keys","Object","lastval","insertId","list","this1","hasOwnProperty","origin","cols","apply","ix","sqlCreateIndex","escapeName","nCols","indexOf","field","s","zeroPad","number","res","toString","settings","nameFormat","NAME_FORMAT","forceAlias","unquoted","Date","escapeDate","bind","REGEXP_SINGLE_QUOTE","SINGLE_QUOTE_ESCAPE","REGEXP_DOUBLE_QUOTE","DOUBLE_QUOTE_ESCAPE","REGEXP_SLASH","SLASH_ESCAPE","val","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","millisecond","getMilliseconds","offset","getTimezoneOffset","timezone","Math","floor","p0","p1","escape","s1","pos","valueOf"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n'use strict';\nimport 'source-map-support/register';\nimport async from 'async';\nimport {_} from 'lodash';\nimport util from 'util';\nimport {SqlFormatter} from '@themost/query/formatter';\nimport sqlite from 'sqlite3';\nimport {SqlUtils} from \"@themost/query/utils\";\nimport {QueryExpression,QueryField} from \"@themost/query/query\";\nconst sqlite3 = sqlite.verbose();\n\n/**\n * @class\n * @augments DataAdapter\n * @param {*} options\n * @constructor\n */\nexport class SqliteAdapter {\n    \n    constructor(options) {\n        /**\n         * @type {{database: string}}\n         */\n        this.options = options || { database: ':memory:' };\n        /**\n         * Represents the database raw connection associated with this adapter\n         * @type {*}\n         */\n        this.rawConnection = null;\n    }\n\n    open(callback) {\n        const self = this;\n        callback = callback || function() {};\n        if (self.rawConnection) {\n            callback();\n        }\n        else {\n            //try to open or create database\n            self.rawConnection = new sqlite3.Database(self.options.database,6, function(err) {\n                if (err) {\n                    self.rawConnection = null;\n                }\n                callback(err);\n\n            });\n        }\n    }\n\n    close(callback) {\n        const self = this;\n        callback = callback || function() {};\n        try {\n            if (self.rawConnection)\n            {\n                //close connection\n                self.rawConnection.close(function() {\n                    //and finally return\n                    callback();\n                });\n            }\n            else {\n                callback();\n            }\n\n        }\n        catch (e) {\n            console.log('An error occured while closing database.');\n            console.log(e.message);\n            //call callback without error\n            callback();\n        }\n    }\n\n    /**\n     * @param {string} query\n     * @param {*=} values\n     */\n    prepare(query, values) {\n        return SqlUtils.prepare(query,values);\n    }\n\n    static formatType(field) {\n        const size = parseInt(field.size);\n        let s;\n        switch (field.type)\n        {\n            case 'Boolean':\n                s = 'INTEGER(1,0)';\n                break;\n            case 'Byte':\n                s = 'INTEGER(1,0)';\n                break;\n            case 'Number':\n            case 'Float':\n                s = 'REAL';\n                break;\n            case 'Counter':\n                return 'INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL';\n            case 'Currency':\n                s =  'NUMERIC(' + (field.size || 19) + ',4)';\n                break;\n            case 'Decimal':\n                s =  'NUMERIC';\n                if ((field.size) && (field.scale)) { s += '(' + field.size + ',' + field.scale + ')'; }\n                break;\n            case 'Date':\n            case 'DateTime':\n                s = 'NUMERIC';\n                break;\n            case 'Time':\n                s = size>0 ?  util.format('TEXT(%s,0)', size) : 'TEXT';\n                break;\n            case 'Long':\n            case 'Duration':\n                s = size>0 ?  util.format('TEXT(%s,0)', size) : 'TEXT';\n                break;\n            case 'Integer':\n                s = 'INTEGER' + (field.size ? '(' + field.size + ',0)':'' );\n                break;\n            case 'URL':\n            case 'Text':\n            case 'Note':\n                s =field.size ? util.format('TEXT(%s,0)', field.size) : 'TEXT';\n                break;\n            case 'Image':\n            case 'Binary':\n                s ='BLOB';\n                break;\n            case 'Guid':\n                s = 'TEXT(36,0)';\n                break;\n            case 'Short':\n                s = 'INTEGER(2,0)';\n                break;\n            default:\n                s = 'INTEGER';\n                break;\n        }\n        if (field.primary) {\n            return s.concat(' PRIMARY KEY NOT NULL');\n        }\n        else {\n            return s.concat((field.nullable===undefined) ? ' NULL': (field.nullable ? ' NULL': ' NOT NULL'));\n        }\n    }\n\n    /**\n     * Begins a transactional operation by executing the given function\n     * @param fn {function} The function to execute\n     * @param callback {function(Error=)} The callback that contains the error -if any- and the results of the given operation\n     */\n    executeInTransaction(fn, callback) {\n        const self = this;\n        //ensure parameters\n        fn = fn || function() {}; callback = callback || function() {};\n        self.open(function(err) {\n            if (err) {\n                callback(err);\n            }\n            else {\n                if (self.transaction) {\n                    fn.call(self, function(err) {\n                        callback(err);\n                    });\n                }\n                else {\n                    //begin transaction\n                    self.rawConnection.run('BEGIN TRANSACTION;', undefined, function(err) {\n                        if (err) {\n                            callback(err);\n                            return;\n                        }\n                        //initialize dummy transaction object (for future use)\n                        self.transaction = { };\n                        //execute function\n                        fn.call(self, function(err) {\n                            if (err) {\n                                //rollback transaction\n                                self.rawConnection.run('ROLLBACK;', undefined, function() {\n                                    self.transaction = null;\n                                    callback(err);\n                                });\n                            }\n                            else {\n                                //commit transaction\n                                self.rawConnection.run('COMMIT;', undefined, function(err) {\n                                    self.transaction = null;\n                                    callback(err);\n                                });\n                            }\n                        });\n                    });\n                }\n            }\n        });\n    }\n\n    /**\n     *\n     * @param {string} name\n     * @param {QueryExpression|*} query\n     * @param {function(Error=)} callback\n     */\n    createView(name, query, callback) {\n        this.view(name).create(query, callback);\n    }\n\n    /*\n     * @param {DataModelMigration|*} obj An Object that represents the data model scheme we want to migrate\n     * @param {function(Error=)} callback\n     */\n    migrate(obj, callback) {\n        const self = this;\n        callback = callback || function() {};\n        if (_.isNil(obj)) { return callback(); }\n        /**\n         * @type {DataModelMigration|*}\n         */\n        const migration = obj;\n\n        const format = function(format, obj)\n        {\n            let result = format;\n            if (/%t/.test(format))\n                result = result.replace(/%t/g,SqliteAdapter.formatType(obj));\n            if (/%f/.test(format))\n                result = result.replace(/%f/g,obj.name);\n            return result;\n        };\n\n\n        async.waterfall([\n            //1. Check migrations table existence\n            function(cb) {\n                if (SqliteAdapter.supportMigrations) {\n                    cb(null, true);\n                    return;\n                }\n                self.table('migrations').exists(function(err, exists) {\n                    if (err) { cb(err); return; }\n                    cb(null, exists);\n                });\n            },\n            //2. Create migrations table, if it does not exist\n            function(arg, cb) {\n                if (arg) { cb(null, 0); return; }\n                //create migrations table\n                self.execute('CREATE TABLE migrations(\"id\" INTEGER PRIMARY KEY AUTOINCREMENT, ' +\n                    '\"appliesTo\" TEXT NOT NULL, \"model\" TEXT NULL, \"description\" TEXT,\"version\" TEXT NOT NULL)',\n                    [], function(err) {\n                        if (err) { cb(err); return; }\n                        SqliteAdapter.supportMigrations=true;\n                        cb(null, 0);\n                    });\n            },\n            //3. Check if migration has already been applied (true=Table version is equal to migration version, false=Table version is older from migration version)\n            function(arg, cb) {\n                self.table(migration.appliesTo).version(function(err, version) {\n                    if (err) { cb(err); return; }\n                    cb(null, (version>=migration.version));\n                });\n            },\n            //4a. Check table existence (-1=Migration has already been applied, 0=Table does not exist, 1=Table exists)\n            function(arg, cb) {\n                //migration has already been applied (set migration.updated=true)\n                if (arg) {\n                    migration.updated=true;\n                    cb(null, -1);\n                }\n                else {\n                    self.table(migration.appliesTo).exists(function(err, exists) {\n                        if (err) { cb(err); return; }\n                        cb(null, exists ? 1 : 0);\n                    });\n\n                }\n            },\n            //4. Get table columns\n            function(arg, cb) {\n                //migration has already been applied\n                if (arg<0) { cb(null, [arg, null]); return; }\n                self.table(migration.appliesTo).columns(function(err, columns) {\n                    if (err) { cb(err); return; }\n                    cb(null, [arg, columns]);\n                });\n            },\n            //5. Migrate target table (create or alter)\n            function(args, cb) {\n                //migration has already been applied (args[0]=-1)\n                if (args[0] < 0) {\n                    cb(null, args[0]);\n                }\n                else if (args[0] === 0) {\n                    //create table\n                    const strFields = migration.add.filter(function(x) {\n                        return !x['oneToMany'];\n                    }).map(\n                        function(x) {\n                            return format('\"%f\" %t', x);\n                        }).join(', ');\n                    const sql = util.format('CREATE TABLE \"%s\" (%s)', migration.appliesTo, strFields);\n                    self.execute(sql, null, function(err) {\n                        if (err) { cb(err); return; }\n                        cb(null, 1);\n                    });\n                }\n                else if (args[0] === 1) {\n                    const expressions = [];\n\n                    const /**\n                     * @type {{columnName:string,ordinal:number,dataType:*, maxLength:number,isNullable:number,,primary:boolean }[]}\n                     */\n                    columns = args[1];\n\n                    let forceAlter = false;\n                    let column;\n                    let newType;\n                    let oldType;\n                    //validate operations\n\n                    //1. columns to be removed\n                    if (util.isArray(migration.remove)) {\n                        if (migration.remove>0) {\n                            for (let i = 0; i < migration.remove.length; i++) {\n                                let x = migration.remove[i];\n                                const colIndex = _.findIndex(columns, (y) => { return y.name === x.name; });\n                                if (colIndex>=0) {\n                                    if (!columns[colIndex].primary) {\n                                        forceAlter = true;\n                                    }\n                                    else {\n                                        migration.remove.splice(i, 1);\n                                        i-=1;\n                                    }\n                                }\n                                else {\n                                    migration.remove.splice(i, 1);\n                                    i-=1;\n                                }\n                            }\n                        }\n                    }\n                    //1. columns to be changed\n                    if (util.isArray(migration.change)) {\n                        if (migration.change>0) {\n\n                            for (let i = 0; i < migration.change.length; i++) {\n                                let x = migration.change[i];\n                                column = _.find(function(y) { return y.name === x.name; });\n                                if (column) {\n                                    if (!column.primary) {\n                                        //validate new column type (e.g. TEXT(120,0) NOT NULL)\n                                        newType = format('%t', x); oldType = column.type.toUpperCase().concat(column.nullable ? ' NOT NULL' : ' NULL');\n                                        if ((newType !== oldType)) {\n                                            //force alter\n                                            forceAlter = true;\n                                        }\n                                    }\n                                    else {\n                                        //remove column from change collection (because it's a primary key)\n                                        migration.change.splice(i, 1);\n                                        i-=1;\n                                    }\n                                }\n                                else {\n                                    //add column (column was not found in table)\n                                    migration.add.push(x);\n                                    //remove column from change collection\n                                    migration.change.splice(i, 1);\n                                    i-=1;\n                                }\n\n                            }\n\n                        }\n                    }\n                    if (util.isArray(migration.add)) {\n\n                        for (let i = 0; i < migration.add.length; i++) {\n                            let x = migration.add[i];\n                            column = _.find(function(y) { return (y.name === x.name); });\n                            if (column) {\n                                if (column.primary) {\n                                    migration.add.splice(i, 1);\n                                    i-=1;\n                                }\n                                else {\n                                    newType = format('%t', x); oldType = column.type.toUpperCase().concat(column.nullable ? ' NOT NULL' : ' NULL');\n                                    if (newType === oldType) {\n                                        //remove column from add collection\n                                        migration.add.splice(i, 1);\n                                        i-=1;\n                                    }\n                                    else {\n                                        forceAlter = true;\n                                    }\n                                }\n                            }\n                        }\n                        if (forceAlter) {\n                            cb(new Error('Full table migration is not yet implemented.'));\n                            return;\n                        }\n                        else {\n                            migration.add.forEach(function(x) {\n                                //search for columns\n                                expressions.push(util.format('ALTER TABLE \"%s\" ADD COLUMN \"%s\" %s', migration.appliesTo, x.name, SqliteAdapter.formatType(x)));\n                            });\n                        }\n\n                    }\n                    if (expressions.length>0) {\n                        async.eachSeries(expressions, function(expr,cb) {\n                            self.execute(expr, [], function(err) {\n                                cb(err);\n                            });\n                        }, function(err) {\n                            if (err) { cb(err); return; }\n                            cb(null, 1);\n                        });\n                    }\n                    else {\n                        cb(null, 2);\n                    }\n                }\n                else {\n                    cb(new Error('Invalid table status.'));\n                }\n            },\n            //Apply data model indexes\n            function (arg, cb) {\n                if (arg<=0) { return cb(null, arg); }\n                if (migration.indexes) {\n                    const tableIndexes = self.indexes(migration.appliesTo);\n                    //enumerate migration constraints\n                    async.eachSeries(migration.indexes, function(index, indexCallback) {\n                        tableIndexes.create(index.name, index.columns, indexCallback);\n                    }, function(err) {\n                        //throw error\n                        if (err) { return cb(err); }\n                        //or return success flag\n                        return cb(null, 1);\n                    });\n                }\n                else {\n                    //do nothing and exit\n                    return cb(null, 1);\n                }\n            },\n            function(arg, cb) {\n                if (arg>0) {\n                    //log migration to database\n                    self.execute('INSERT INTO migrations(\"appliesTo\", \"model\", \"version\", \"description\") VALUES (?,?,?,?)', [migration.appliesTo,\n                        migration.model,\n                        migration.version,\n                        migration.description ], function(err) {\n                        if (err)  {\n                            return cb(err);\n                        }\n                        cb(null, 1);\n                    });\n                }\n                else {\n                    migration.updated = true;\n                    cb(null, arg);\n                }\n            }\n        ], function(err) {\n            callback(err);\n        });\n\n    }\n\n    /**\n     * Produces a new identity value for the given entity and attribute.\n     * @param entity {String} The target entity name\n     * @param attribute {String} The target attribute\n     * @param callback {Function=}\n     */\n    selectIdentity(entity, attribute, callback) {\n\n        const self = this;\n\n        const migration = {\n            appliesTo:'increment_id',\n            model:'increments',\n            description:'Increments migration (version 1.0)',\n            version:'1.0',\n            add:[\n                { name:'id', type:'Counter', primary:true },\n                { name:'entity', type:'Text', size:120 },\n                { name:'attribute', type:'Text', size:120 },\n                { name:'value', type:'Integer' }\n            ]\n        };\n        //ensure increments entity\n        self.migrate(migration, function(err)\n        {\n            //throw error if any\n            if (err) { callback.call(self,err); return; }\n            self.execute('SELECT * FROM increment_id WHERE entity=? AND attribute=?', [entity, attribute], function(err, result) {\n                if (err) { callback.call(self,err); return; }\n                if (result.length===0) {\n                    //get max value by querying the given entity\n                    const q = QueryExpression.create(entity).select(QueryField.create().max(attribute));\n                    self.execute(q,null, function(err, result) {\n                        if (err) { callback.call(self, err); return; }\n                        let value = 1;\n                        if (result.length>0) {\n                            value = (parseInt(result[0][attribute]) || 0)+ 1;\n                        }\n                        self.execute('INSERT INTO increment_id(entity, attribute, value) VALUES (?,?,?)',[entity, attribute, value], function(err) {\n                            //throw error if any\n                            if (err) { callback.call(self, err); return; }\n                            //return new increment value\n                            callback.call(self, err, value);\n                        });\n                    });\n                }\n                else {\n                    //get new increment value\n                    const value = parseInt(result[0].value) + 1;\n                    self.execute('UPDATE increment_id SET value=? WHERE id=?',[value, result[0].id], function(err) {\n                        //throw error if any\n                        if (err) { callback.call(self, err); return; }\n                        //return new increment value\n                        callback.call(self, err, value);\n                    });\n                }\n            });\n        });\n    }\n\n    /**\n     * Executes an operation against database and returns the results.\n     * @param {*} batch\n     * @param {function(Error=)} callback\n     */\n    executeBatch(batch, callback) {\n        callback = callback || function() {};\n        callback(new Error('DataAdapter.executeBatch() is obsolete. Use DataAdapter.executeInTransaction() instead.'));\n    }\n\n    table(name) {\n        const self = this;\n        return {\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            exists:function(callback) {\n                self.execute('SELECT COUNT(*) count FROM sqlite_master WHERE name=? AND type=\\'table\\';', [name], function(err, result) {\n                    if (err) { callback(err); return; }\n                    callback(null, (result[0].count>0));\n                });\n            },\n            /**\n             * @param {function(Error,string=)} callback\n             */\n            version:function(callback) {\n                self.execute('SELECT MAX(version) AS version FROM migrations WHERE appliesTo=?',\n                    [name], function(err, result) {\n                        if (err) { cb(err); return; }\n                        if (result.length === 0)\n                            callback(null, '0.0');\n                        else\n                            callback(null, result[0].version || '0.0');\n                    });\n            },\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            has_sequence:function(callback) {\n                callback = callback || function() {};\n                self.execute('SELECT COUNT(*) count FROM sqlite_sequence WHERE name=?',\n                    [name], function(err, result) {\n                        if (err) { callback(err); return; }\n                        callback(null, (result[0].count>0));\n                    });\n            },\n            /**\n             * @param {function(Error=,Array=)} callback\n             */\n            columns:function(callback) {\n                callback = callback || function() {};\n                self.execute('PRAGMA table_info(?)',\n                    [name], function(err, result) {\n                        if (err) { callback(err); return; }\n                        const arr = [];\n                        /**\n                         * enumerates table columns\n                         * @param {{name:string},{cid:number},{type:string},{notnull:number},{pk:number}} x\n                         */\n                        const iterator = function(x) {\n                            const col = { name: x.name, ordinal: x.cid, type: x.type,nullable: (x.notnull ? true : false), primary: (x.pk==1) };\n                            const matches = /(\\w+)\\((\\d+),(\\d+)\\)/.exec(x.type);\n                            if (matches) {\n                                //extract max length attribute (e.g. integer(2,0) etc)\n                                if (parseInt(matches[2])>0) { col.size =  parseInt(matches[2]); }\n                                //extract scale attribute from field (e.g. integer(2,0) etc)\n                                if (parseInt(matches[3])>0) { col.scale =  parseInt(matches[3]); }\n                            }\n                            arr.push(col);\n                        };\n                        result.forEach(iterator);\n                        callback(null, arr);\n                    });\n            }\n        };\n\n    }\n\n    view(name) {\n        const self = this;\n        return {\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            exists:function(callback) {\n                self.execute('SELECT COUNT(*) count FROM sqlite_master WHERE name=? AND type=\\'view\\';', [name], function(err, result) {\n                    if (err) { callback(err); return; }\n                    callback(null, (result[0].count>0));\n                });\n            },\n            /**\n             * @param {function(Error=)} callback\n             */\n            drop:function(callback) {\n                callback = callback || function() {};\n                self.open(function(err) {\n                   if (err) { callback(err); return; }\n                    const sql = util.format(\"DROP VIEW IF EXISTS %s\",name);\n                    self.execute(sql, undefined, function(err) {\n                        if (err) { callback(err); return; }\n                        callback();\n                    });\n                });\n            },\n            /**\n             * @param {QueryExpression|*} q\n             * @param {function(Error=)} callback\n             */\n            create:function(q, callback) {\n                const thisArg = this;\n                self.executeInTransaction(function(tr) {\n                    thisArg.drop(function(err) {\n                        if (err) { tr(err); return; }\n                        try {\n                            let sql = util.format(\"CREATE VIEW %s AS \",name);\n                            const formatter = new SqliteFormatter();\n                            sql += formatter.format(q);\n                            self.execute(sql, undefined, tr);\n                        }\n                        catch(e) {\n                            tr(e);\n                        }\n                    });\n                }, function(err) {\n                    callback(err);\n                });\n\n            }\n        };\n    }\n\n    /**\n     * Executes a query against the underlying database\n     * @param query {QueryExpression|string|*}\n     * @param values {*=}\n     * @param {function(Error=,*=)} callback\n     */\n    execute(query, values, callback) {\n        const self = this;\n        let sql = null;\n        try {\n\n            if (typeof query === 'string') {\n                //get raw sql statement\n                sql = query;\n            }\n            else {\n                //format query expression or any object that may be act as query expression\n                const formatter = new SqliteFormatter();\n                sql = formatter.format(query);\n            }\n            //validate sql statement\n            if (typeof sql !== 'string') {\n                callback.call(self, new Error('The executing command is of the wrong type or empty.'));\n                return;\n            }\n            //ensure connection\n            self.open(function(err) {\n                if (err) {\n                    callback.call(self, err);\n                }\n                else {\n                    //log statement (optional)\n                    if (process.env.NODE_ENV==='development')\n                        console.log(util.format('SQL:%s, Parameters:%s', sql, JSON.stringify(values)));\n\n                    //prepare statement - the traditional way\n                    const prepared = self.prepare(sql, values);\n\n                    let fn;\n                    //validate statement\n                    if (/^(SELECT|PRAGMA)/ig.test(prepared)) {\n                        //prepare for select\n                        fn = self.rawConnection.all;\n                    }\n                    else {\n                        //otherwise prepare for run\n                        fn = self.rawConnection.run;\n                    }\n                    //execute raw command\n                    fn.call(self.rawConnection, prepared, [] , function(err, result) {\n                        if (err) {\n                            //log sql\n                            console.log(util.format('SQL Error:%s', prepared));\n                            callback(err);\n                        }\n                        else {\n                            if (result) {\n                                if (typeof result === 'object') {\n                                    let keys;\n                                    if (util.isArray(result)) {\n                                        if (result.length>0) {\n                                            keys = Object.keys(result[0]);\n                                            result.forEach(function(x) {\n                                                keys.forEach(function(y) {\n                                                    if (x[y] === null) { delete x[y]; }\n                                                });\n                                            });\n                                        }\n                                    }\n                                    else {\n                                        keys = Object.keys(result);\n                                        keys.forEach(function(y) {\n                                            if (result[y] === null) { delete result[y]; }\n                                        });\n                                    }\n                                }\n                                return callback(null, result);\n                            }\n                            else {\n                                return callback();\n                            }\n\n                        }\n                    });\n                }\n            });\n        }\n        catch (e) {\n            callback.call(self, e);\n        }\n    }\n\n    lastIdentity(callback) {\n        const self = this;\n        self.open(function(err) {\n            if (err) {\n                callback(err);\n            }\n            else {\n                //execute lastval (for sequence)\n                self.execute('SELECT last_insert_rowid() as lastval', [], function(err, lastval) {\n                    if (err) {\n                        callback(null, { insertId: null });\n                    }\n                    else {\n                        lastval = lastval || [];\n                        if (lastval.length>0)\n                            callback(null, { insertId:lastval[0].lastval });\n                        else\n                            callback(null, { insertId: null });\n                    }\n                });\n            }\n        });\n    }\n\n    indexes(table) {\n        const self = this, formatter = new SqliteFormatter();\n        return {\n            list: function (callback) {\n                const this1 = this;\n                if (this1.hasOwnProperty('indexes_')) {\n                    return callback(null, this1['indexes_']);\n                }\n                self.execute(util.format('PRAGMA INDEX_LIST(`%s`)', table), null , function (err, result) {\n                    if (err) { return callback(err); }\n                    const indexes = result.filter(function(x) {\n                        return x.origin === 'c';\n                    }).map(function(x) {\n                        return {\n                            name:x.name,\n                            columns:[]\n                        };\n                    });\n                    async.eachSeries(indexes, function(index, cb) {\n                        self.execute(util.format('PRAGMA INDEX_INFO(`%s`)', index.name), function(err, columns) {\n                           if (err) { return cb(err); }\n                            index.columns = columns.map(function(x) {\n                                return x.name;\n                            });\n                        });\n                    }, function(err) {\n                        if (err) {\n                            return callback(err);\n                        }\n                        this1['indexes_'] = indexes;\n                        return callback(null, indexes);\n                    });\n                });\n            },\n            /**\n             * @param {string} name\n             * @param {Array|string} columns\n             * @param {Function} callback\n             */\n            create: function(name, columns, callback) {\n                const cols = [];\n                if (typeof columns === 'string') {\n                    cols.push(columns)\n                }\n                else if (util.isArray(columns)) {\n                    cols.push.apply(cols, columns);\n                }\n                else {\n                    return callback(new Error(\"Invalid parameter. Columns parameter must be a string or an array of strings.\"));\n                }\n\n                this.list(function(err, indexes) {\n                    if (err) { return callback(err); }\n                    const ix = indexes.find(function(x) { return x.name === name; });\n                    //format create index SQL statement\n                    const sqlCreateIndex = util.format(\"CREATE INDEX %s ON %s(%s)\",\n                        formatter.escapeName(name),\n                        formatter.escapeName(table),\n                        cols.map(function(x) {\n                            return formatter.escapeName(x)\n                        }).join(\",\"));\n                    if (typeof ix === 'undefined' || ix === null) {\n                        self.execute(sqlCreateIndex, [], callback);\n                    }\n                    else {\n                        let nCols = cols.length;\n                        //enumerate existing columns\n                        ix.columns.forEach(function(x) {\n                            if (cols.indexOf(x)>=0) {\n                                //column exists in index\n                                nCols -= 1;\n                            }\n                        });\n                        if (nCols>0) {\n                            //drop index\n                            this.drop(name, function(err) {\n                                if (err) { return callback(err); }\n                                //and create it\n                                self.execute(sqlCreateIndex, [], callback);\n                            });\n                        }\n                        else {\n                            //do nothing\n                            return callback();\n                        }\n                    }\n                });\n\n\n            },\n            drop: function(name, callback) {\n                if (typeof name !== 'string') {\n                    return callback(new Error(\"Name must be a valid string.\"));\n                }\n                self.execute(util.format('PRAGMA INDEX_LIST(`%s`)', table), null, function(err, result) {\n                    if (err) { return callback(err); }\n                    const exists = typeof result.find(function(x) { return x.name===name; }) !== 'undefined';\n                    if (!exists) {\n                        return callback();\n                    }\n                    self.execute(util.format(\"DROP INDEX %s\", self.escapeName(name)), [], callback);\n                });\n            }\n        }\n    }\n}\n\nfunction zeroPad(number, length) {\n    number = number || 0;\n    let res = number.toString();\n    while (res.length < length) {\n        res = '0' + res;\n    }\n    return res;\n}\n\n/**\n * @augments {SqlFormatter}\n */\nexport class SqliteFormatter extends SqlFormatter {\n    /**\n     * @constructor\n     */\n    constructor() {\n        super();\n        this.settings = {\n            nameFormat:SqliteFormatter.NAME_FORMAT,\n            forceAlias:true\n        };\n    }\n\n    escapeName(name) {\n        if (typeof name === 'string')\n            return name.replace(/(\\w+)/ig, this.settings.nameFormat);\n        return name;\n    }\n\n    /**\n     * Escapes an object or a value and returns the equivalent sql value.\n     * @param {*} value - A value that is going to be escaped for SQL statements\n     * @param {boolean=} unquoted - An optional value that indicates whether the resulted string will be quoted or not.\n     * returns {string} - The equivalent SQL string value\n     */\n    escape(value, unquoted) {\n        if (typeof value === 'boolean') { return value ? '1' : '0'; }\n        if (value instanceof Date) {\n            return this.escapeDate(value);\n        }\n        let res = super.escape.bind(this)(value, unquoted);\n        if (typeof value === 'string') {\n            if (REGEXP_SINGLE_QUOTE.test(res))\n            //escape single quote (that is already escaped)\n                res = res.replace(/\\\\'/g, SINGLE_QUOTE_ESCAPE);\n            if (REGEXP_DOUBLE_QUOTE.test(res))\n            //escape double quote (that is already escaped)\n                res = res.replace(/\\\\\"/g, DOUBLE_QUOTE_ESCAPE);\n            if (REGEXP_SLASH.test(res))\n            //escape slash (that is already escaped)\n                res = res.replace(/\\\\\\\\/g, SLASH_ESCAPE);\n        }\n        return res;\n    }\n\n    /**\n     * @param {Date|*} val\n     * @returns {string}\n     */\n    escapeDate(val) {\n        const year   = val.getFullYear();\n        const month  = zeroPad(val.getMonth() + 1, 2);\n        const day    = zeroPad(val.getDate(), 2);\n        const hour   = zeroPad(val.getHours(), 2);\n        const minute = zeroPad(val.getMinutes(), 2);\n        const second = zeroPad(val.getSeconds(), 2);\n        const millisecond = zeroPad(val.getMilliseconds(), 3);\n        //format timezone\n        const offset = val.getTimezoneOffset(), timezone = (offset<=0 ? '+' : '-') + zeroPad(-Math.floor(offset/60),2) + ':' + zeroPad(offset%60,2);\n        return \"'\" + year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second + \".\" + millisecond + timezone + \"'\";\n    }\n\n    /**\n     * Implements indexOf(str,substr) expression formatter.\n     * @param {string} p0 The source string\n     * @param {string} p1 The string to search for\n     * @returns {string}\n     */\n    $indexof(p0, p1) {\n        return util.format('(INSTR(%s,%s)-1)', this.escape(p0), this.escape(p1));\n    }\n\n    /**\n     * Implements indexOf(str,substr) expression formatter.\n     * @param {string} p0 The source string\n     * @param {string} p1 The string to search for\n     * @returns {string}\n     */\n    $indexOf(p0, p1) {\n        return util.format('(INSTR(%s,%s)-1)', this.escape(p0), this.escape(p1));\n    }\n\n    /**\n     * Implements contains(a,b) expression formatter.\n     * @param {*} p0 The source string\n     * @param {*} p1 The string to search for\n     * @returns {string}\n     */\n    $text(p0, p1) {\n        return util.format('(INSTR(%s,%s)-1)>=0', this.escape(p0), this.escape(p1));\n    }\n\n    /**\n     * Implements simple regular expression formatter. Important Note: SQLite 3 does not provide a core sql function for regular expression matching.\n     * @param {*} p0 The source string or field\n     * @param {*} p1 The string to search for\n     */\n    $regex(p0, p1) {\n        //escape expression\n        let s1 = this.escape(p1, true);\n        //implement starts with equivalent for LIKE T-SQL\n        if (/^\\^/.test(s1)) {\n            s1 = s1.replace(/^\\^/,'');\n        }\n        else {\n            s1 = '%' + s1;\n        }\n        //implement ends with equivalent for LIKE T-SQL\n        if (/\\$$/.test(s1)) {\n            s1 = s1.replace(/\\$$/,'');\n        }\n        else {\n            s1 += '%';\n        }\n        return util.format('LIKE(\\'%s\\',%s) >= 1',s1, this.escape(p0));\n    }\n\n    /**\n     * Implements concat(a,b) expression formatter.\n     * @param {*} p0\n     * @param {*} p1\n     * @returns {string}\n     */\n    $concat(p0, p1) {\n        return util.format('(IFNULL(%s,\\'\\') || IFNULL(%s,\\'\\'))', this.escape(p0),  this.escape(p1));\n    }\n\n    /**\n     * Implements substring(str,pos) expression formatter.\n     * @param {String} p0 The source string\n     * @param {Number} pos The starting position\n     * @param {Number=} length The length of the resulted string\n     * @returns {string}\n     */\n    $substring(p0, pos, length) {\n        if (length)\n            return util.format('SUBSTR(%s,%s,%s)', this.escape(p0), pos.valueOf()+1, length.valueOf());\n        else\n            return util.format('SUBSTR(%s,%s)', this.escape(p0), pos.valueOf()+1);\n    }\n\n    /**\n     * Implements substring(str,pos) expression formatter.\n     * @param {String} p0 The source string\n     * @param {Number} pos The starting position\n     * @param {Number=} length The length of the resulted string\n     * @returns {string}\n     */\n    $substr(p0, pos, length) {\n        if (length)\n            return util.format('SUBSTR(%s,%s,%s)', this.escape(p0), pos.valueOf()+1, length.valueOf());\n        else\n            return util.format('SUBSTR(%s,%s)', this.escape(p0), pos.valueOf()+1);\n    }\n\n    /**\n     * Implements length(a) expression formatter.\n     * @param {*} p0\n     * @returns {string}\n     */\n    $length(p0) {\n        return util.format('LENGTH(%s)', this.escape(p0));\n    }\n\n    $ceiling(p0) {\n        return util.format('CEIL(%s)', this.escape(p0));\n    }\n\n    $startswith(p0, p1) {\n        //validate params\n        if (_.isNil(p0) || _.isNil(p1))\n            return '';\n        return 'LIKE(\\'' + this.escape(p1, true) + '%\\',' + this.escape(p0) + ')';\n    }\n\n    $contains(p0, p1) {\n        //validate params\n        if (_.isNil(p0) || _.isNil(p1))\n            return '';\n        return 'LIKE(\\'%' + this.escape(p1, true) + '%\\',' + this.escape(p0) + ')';\n    }\n\n    $endswith(p0, p1) {\n        //validate params\n        if (_.isNil(p0) || _.isNil(p1))\n            return '';\n        return 'LIKE(\\'%' + this.escape(p1, true) + '\\',' + this.escape(p0) + ')';\n    }\n\n    $day(p0) { return 'CAST(strftime(\\'%d\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $dayOfMonth(p0) { return 'CAST(strftime(\\'%d\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $month(p0) { return 'CAST(strftime(\\'%m\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $year(p0) { return 'CAST(strftime(\\'%Y\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $hour(p0) { return 'CAST(strftime(\\'%H\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $minute(p0) { return 'CAST(strftime(\\'%M\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $second(p0) { return 'CAST(strftime(\\'%S\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $date(p0) { return 'date(' + this.escape(p0) + ')'; }\n}\n\nSqliteFormatter.NAME_FORMAT = '`$1`';\n\nconst REGEXP_SINGLE_QUOTE=/\\\\'/g, SINGLE_QUOTE_ESCAPE ='\\'\\'',\n    REGEXP_DOUBLE_QUOTE=/\\\\\"/g, DOUBLE_QUOTE_ESCAPE = '\"',\n    REGEXP_SLASH=/\\\\\\\\/g, SLASH_ESCAPE = '\\\\';\n\n/**\n * Creates an instance of SqliteAdapter object that represents a SQLite database connection.\n * @param {*} options An object that represents the properties of the underlying database connection.\n * @returns {*}\n */\nexport function createInstance(options) {\n    return new SqliteAdapter(options);\n}\n"]}