{"version":3,"sources":["index.es6"],"names":["createInstance","async","_","util","SqlFormatter","sqlite","SqlUtils","QueryExpression","QueryField","sqlite3","verbose","SqliteAdapter","options","database","rawConnection","callback","self","Database","err","close","e","console","log","message","query","values","prepare","fn","open","transaction","call","run","undefined","name","view","create","obj","isNil","migration","format","result","test","replace","formatType","waterfall","cb","supportMigrations","table","exists","arg","execute","appliesTo","version","columns","args","strFields","add","filter","x","map","join","sql","expressions","forceAlter","column","newType","oldType","isArray","remove","i","colIndex","indexOf","y","primary","splice","length","change","find","type","toUpperCase","concat","nullable","push","Error","forEach","eachSeries","expr","indexes","tableIndexes","index","indexCallback","model","description","entity","attribute","size","migrate","q","select","max","value","parseInt","id","batch","count","has_sequence","arr","iterator","col","ordinal","cid","notnull","pk","matches","exec","scale","drop","thisArg","executeInTransaction","tr","formatter","SqliteFormatter","process","env","NODE_ENV","JSON","stringify","prepared","all","keys","Object","lastval","insertId","list","this1","hasOwnProperty","origin","cols","apply","ix","sqlCreateIndex","escapeName","nCols","field","s","zeroPad","number","res","toString","settings","nameFormat","NAME_FORMAT","forceAlias","unquoted","Date","escapeDate","bind","REGEXP_SINGLE_QUOTE","SINGLE_QUOTE_ESCAPE","REGEXP_DOUBLE_QUOTE","DOUBLE_QUOTE_ESCAPE","REGEXP_SLASH","SLASH_ESCAPE","val","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","millisecond","getMilliseconds","offset","getTimezoneOffset","timezone","Math","floor","p0","p1","escape","s1","pos","valueOf"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n'use strict';\nimport 'source-map-support/register';\nimport async from 'async';\nimport {_} from 'lodash';\nimport util from 'util';\nimport {SqlFormatter} from '@themost/query/formatter';\nimport sqlite from 'sqlite3';\nimport {SqlUtils} from \"@themost/query/utils\";\nimport {QueryExpression,QueryField} from \"@themost/query/query\";\nconst sqlite3 = sqlite.verbose();\n\n/**\n * @class\n * @augments DataAdapter\n * @param {*} options\n * @constructor\n */\nexport class SqliteAdapter {\n    \n    constructor(options) {\n        /**\n         * @type {{database: string}}\n         */\n        this.options = options || { database: ':memory:' };\n        /**\n         * Represents the database raw connection associated with this adapter\n         * @type {*}\n         */\n        this.rawConnection = null;\n    }\n\n    open(callback) {\n        const self = this;\n        callback = callback || function() {};\n        if (self.rawConnection) {\n            callback();\n        }\n        else {\n            //try to open or create database\n            self.rawConnection = new sqlite3.Database(self.options.database,6, function(err) {\n                if (err) {\n                    self.rawConnection = null;\n                }\n                callback(err);\n\n            });\n        }\n    }\n\n    close(callback) {\n        const self = this;\n        callback = callback || function() {};\n        try {\n            if (self.rawConnection)\n            {\n                //close connection\n                self.rawConnection.close(function() {\n                    //and finally return\n                    callback();\n                });\n            }\n            else {\n                callback();\n            }\n\n        }\n        catch (e) {\n            console.log('An error occured while closing database.');\n            console.log(e.message);\n            //call callback without error\n            callback();\n        }\n    }\n\n    /**\n     * @param {string} query\n     * @param {*=} values\n     */\n    prepare(query, values) {\n        return SqlUtils.prepare(query,values)\n    }\n\n    static formatType(field) {\n        const size = parseInt(field.size);\n        let s;\n        switch (field.type)\n        {\n            case 'Boolean':\n                s = 'INTEGER(1,0)';\n                break;\n            case 'Byte':\n                s = 'INTEGER(1,0)';\n                break;\n            case 'Number':\n            case 'Float':\n                s = 'REAL';\n                break;\n            case 'Counter':\n                return 'INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL';\n            case 'Currency':\n                s =  'NUMERIC(' + (field.size || 19) + ',4)';\n                break;\n            case 'Decimal':\n                s =  'NUMERIC';\n                if ((field.size) && (field.scale)) { s += '(' + field.size + ',' + field.scale + ')'; }\n                break;\n            case 'Date':\n            case 'DateTime':\n                s = 'NUMERIC';\n                break;\n            case 'Time':\n                s = size>0 ?  util.format('TEXT(%s,0)', size) : 'TEXT';\n                break;\n            case 'Long':\n            case 'Duration':\n                s = size>0 ?  util.format('TEXT(%s,0)', size) : 'TEXT';\n                break;\n            case 'Integer':\n                s = 'INTEGER' + (field.size ? '(' + field.size + ',0)':'' );\n                break;\n            case 'URL':\n            case 'Text':\n            case 'Note':\n                s =field.size ? util.format('TEXT(%s,0)', field.size) : 'TEXT';\n                break;\n            case 'Image':\n            case 'Binary':\n                s ='BLOB';\n                break;\n            case 'Guid':\n                s = 'TEXT(36,0)';\n                break;\n            case 'Short':\n                s = 'INTEGER(2,0)';\n                break;\n            default:\n                s = 'INTEGER';\n                break;\n        }\n        if (field.primary) {\n            return s.concat(' PRIMARY KEY NOT NULL');\n        }\n        else {\n            return s.concat((field.nullable===undefined) ? ' NULL': (field.nullable ? ' NULL': ' NOT NULL'));\n        }\n    }\n\n    /**\n     * Begins a transactional operation by executing the given function\n     * @param fn {function} The function to execute\n     * @param callback {function(Error=)} The callback that contains the error -if any- and the results of the given operation\n     */\n    executeInTransaction(fn, callback) {\n        const self = this;\n        //ensure parameters\n        fn = fn || function() {}; callback = callback || function() {};\n        self.open(function(err) {\n            if (err) {\n                callback(err);\n            }\n            else {\n                if (self.transaction) {\n                    fn.call(self, function(err) {\n                        callback(err);\n                    });\n                }\n                else {\n                    //begin transaction\n                    self.rawConnection.run('BEGIN TRANSACTION;', undefined, function(err) {\n                        if (err) {\n                            callback(err);\n                            return;\n                        }\n                        //initialize dummy transaction object (for future use)\n                        self.transaction = { };\n                        //execute function\n                        fn.call(self, function(err) {\n                            if (err) {\n                                //rollback transaction\n                                self.rawConnection.run('ROLLBACK;', undefined, function() {\n                                    self.transaction = null;\n                                    callback(err);\n                                });\n                            }\n                            else {\n                                //commit transaction\n                                self.rawConnection.run('COMMIT;', undefined, function(err) {\n                                    self.transaction = null;\n                                    callback(err);\n                                });\n                            }\n                        });\n                    });\n                }\n            }\n        });\n    }\n\n    /**\n     *\n     * @param {string} name\n     * @param {QueryExpression|*} query\n     * @param {function(Error=)} callback\n     */\n    createView(name, query, callback) {\n        this.view(name).create(query, callback);\n    }\n\n    /*\n     * @param {DataModelMigration|*} obj An Object that represents the data model scheme we want to migrate\n     * @param {function(Error=)} callback\n     */\n    migrate(obj, callback) {\n        const self = this;\n        callback = callback || function() {};\n        if (_.isNil(obj)) { return callback(); }\n        /**\n         * @type {DataModelMigration|*}\n         */\n        const migration = obj;\n\n        const format = function(format, obj)\n        {\n            let result = format;\n            if (/%t/.test(format))\n                result = result.replace(/%t/g,SqliteAdapter.formatType(obj));\n            if (/%f/.test(format))\n                result = result.replace(/%f/g,obj.name);\n            return result;\n        };\n\n\n        async.waterfall([\n            //1. Check migrations table existence\n            function(cb) {\n                if (SqliteAdapter.supportMigrations) {\n                    cb(null, true);\n                    return;\n                }\n                self.table('migrations').exists(function(err, exists) {\n                    if (err) { cb(err); return; }\n                    cb(null, exists);\n                });\n            },\n            //2. Create migrations table, if it does not exist\n            function(arg, cb) {\n                if (arg) { cb(null, 0); return; }\n                //create migrations table\n                self.execute('CREATE TABLE migrations(\"id\" INTEGER PRIMARY KEY AUTOINCREMENT, ' +\n                    '\"appliesTo\" TEXT NOT NULL, \"model\" TEXT NULL, \"description\" TEXT,\"version\" TEXT NOT NULL)',\n                    [], function(err) {\n                        if (err) { cb(err); return; }\n                        SqliteAdapter.supportMigrations=true;\n                        cb(null, 0);\n                    });\n            },\n            //3. Check if migration has already been applied (true=Table version is equal to migration version, false=Table version is older from migration version)\n            function(arg, cb) {\n                self.table(migration.appliesTo).version(function(err, version) {\n                    if (err) { cb(err); return; }\n                    cb(null, (version>=migration.version));\n                });\n            },\n            //4a. Check table existence (-1=Migration has already been applied, 0=Table does not exist, 1=Table exists)\n            function(arg, cb) {\n                //migration has already been applied (set migration.updated=true)\n                if (arg) {\n                    migration['updated']=true;\n                    cb(null, -1);\n                }\n                else {\n                    self.table(migration.appliesTo).exists(function(err, exists) {\n                        if (err) { cb(err); return; }\n                        cb(null, exists ? 1 : 0);\n                    });\n\n                }\n            },\n            //4. Get table columns\n            function(arg, cb) {\n                //migration has already been applied\n                if (arg<0) { cb(null, [arg, null]); return; }\n                self.table(migration.appliesTo).columns(function(err, columns) {\n                    if (err) { cb(err); return; }\n                    cb(null, [arg, columns]);\n                });\n            },\n            //5. Migrate target table (create or alter)\n            function(args, cb) {\n                //migration has already been applied (args[0]=-1)\n                if (args[0] < 0) {\n                    cb(null, args[0]);\n                }\n                else if (args[0] === 0) {\n                    //create table\n                    const strFields = migration.add.filter(function(x) {\n                        return !x['oneToMany']\n                    }).map(\n                        function(x) {\n                            return format('\"%f\" %t', x);\n                        }).join(', ');\n                    const sql = util.format('CREATE TABLE \"%s\" (%s)', migration.appliesTo, strFields);\n                    self.execute(sql, null, function(err) {\n                        if (err) { cb(err); return; }\n                        cb(null, 1);\n                    });\n                }\n                else if (args[0] === 1) {\n                    const expressions = [];\n\n                    const /**\n                     * @type {{columnName:string,ordinal:number,dataType:*, maxLength:number,isNullable:number,,primary:boolean }[]}\n                     */\n                    columns = args[1];\n\n                    let forceAlter = false;\n                    let column;\n                    let newType;\n                    let oldType;\n                    //validate operations\n\n                    //1. columns to be removed\n                    if (util.isArray(migration.remove)) {\n                        if (migration.remove>0) {\n                            for (let i = 0; i < migration.remove.length; i++) {\n                                let x = migration.remove[i];\n                                const colIndex = columns.indexOf(function(y) { return y.name === x.name; });\n                                if (colIndex>=0) {\n                                    if (!columns[colIndex].primary) {\n                                        forceAlter = true;\n                                    }\n                                    else {\n                                        migration.remove.splice(i, 1);\n                                        i-=1;\n                                    }\n                                }\n                                else {\n                                    migration.remove.splice(i, 1);\n                                    i-=1;\n                                }\n                            }\n                        }\n                    }\n                    //1. columns to be changed\n                    if (util.isArray(migration.change)) {\n                        if (migration.change>0) {\n\n                            for (let i = 0; i < migration.change.length; i++) {\n                                let x = migration.change[i];\n                                column = _.find(function(y) { return y.name === x.name; });\n                                if (column) {\n                                    if (!column.primary) {\n                                        //validate new column type (e.g. TEXT(120,0) NOT NULL)\n                                        newType = format('%t', x); oldType = column.type.toUpperCase().concat(column.nullable ? ' NOT NULL' : ' NULL');\n                                        if ((newType !== oldType)) {\n                                            //force alter\n                                            forceAlter = true;\n                                        }\n                                    }\n                                    else {\n                                        //remove column from change collection (because it's a primary key)\n                                        migration.change.splice(i, 1);\n                                        i-=1;\n                                    }\n                                }\n                                else {\n                                    //add column (column was not found in table)\n                                    migration.add.push(x);\n                                    //remove column from change collection\n                                    migration.change.splice(i, 1);\n                                    i-=1;\n                                }\n\n                            }\n\n                        }\n                    }\n                    if (util.isArray(migration.add)) {\n\n                        for (let i = 0; i < migration.add.length; i++) {\n                            let x = migration.add[i];\n                            column = _.find(function(y) { return (y.name === x.name); });\n                            if (column) {\n                                if (column.primary) {\n                                    migration.add.splice(i, 1);\n                                    i-=1;\n                                }\n                                else {\n                                    newType = format('%t', x); oldType = column.type.toUpperCase().concat(column.nullable ? ' NOT NULL' : ' NULL');\n                                    if (newType === oldType) {\n                                        //remove column from add collection\n                                        migration.add.splice(i, 1);\n                                        i-=1;\n                                    }\n                                    else {\n                                        forceAlter = true;\n                                    }\n                                }\n                            }\n                        }\n                        if (forceAlter) {\n                            cb(new Error('Full table migration is not yet implemented.'));\n                            return;\n                        }\n                        else {\n                            migration.add.forEach(function(x) {\n                                //search for columns\n                                expressions.push(util.format('ALTER TABLE \"%s\" ADD COLUMN \"%s\" %s', migration.appliesTo, x.name, SqliteAdapter.formatType(x)));\n                            });\n                        }\n\n                    }\n                    if (expressions.length>0) {\n                        async.eachSeries(expressions, function(expr,cb) {\n                            self.execute(expr, [], function(err) {\n                                cb(err);\n                            });\n                        }, function(err) {\n                            if (err) { cb(err); return; }\n                            cb(null, 1);\n                        });\n                    }\n                    else {\n                        cb(null, 2);\n                    }\n                }\n                else {\n                    cb(new Error('Invalid table status.'));\n                }\n            },\n            //Apply data model indexes\n            function (arg, cb) {\n                if (arg<=0) { return cb(null, arg); }\n                if (migration.indexes) {\n                    const tableIndexes = self.indexes(migration.appliesTo);\n                    //enumerate migration constraints\n                    async.eachSeries(migration.indexes, function(index, indexCallback) {\n                        tableIndexes.create(index.name, index.columns, indexCallback);\n                    }, function(err) {\n                        //throw error\n                        if (err) { return cb(err); }\n                        //or return success flag\n                        return cb(null, 1);\n                    });\n                }\n                else {\n                    //do nothing and exit\n                    return cb(null, 1);\n                }\n            },\n            function(arg, cb) {\n                if (arg>0) {\n                    //log migration to database\n                    self.execute('INSERT INTO migrations(\"appliesTo\", \"model\", \"version\", \"description\") VALUES (?,?,?,?)', [migration.appliesTo,\n                        migration.model,\n                        migration.version,\n                        migration.description ], function(err) {\n                        if (err)  {\n                            return cb(err);\n                        }\n                        cb(null, 1);\n                    });\n                }\n                else {\n                    migration['updated'] = true;\n                    cb(null, arg);\n                }\n            }\n        ], function(err) {\n            callback(err);\n        })\n\n    }\n\n    /**\n     * Produces a new identity value for the given entity and attribute.\n     * @param entity {String} The target entity name\n     * @param attribute {String} The target attribute\n     * @param callback {Function=}\n     */\n    selectIdentity(entity, attribute, callback) {\n\n        const self = this;\n\n        const migration = {\n            appliesTo:'increment_id',\n            model:'increments',\n            description:'Increments migration (version 1.0)',\n            version:'1.0',\n            add:[\n                { name:'id', type:'Counter', primary:true },\n                { name:'entity', type:'Text', size:120 },\n                { name:'attribute', type:'Text', size:120 },\n                { name:'value', type:'Integer' }\n            ]\n        };\n        //ensure increments entity\n        self.migrate(migration, function(err)\n        {\n            //throw error if any\n            if (err) { callback.call(self,err); return; }\n            self.execute('SELECT * FROM increment_id WHERE entity=? AND attribute=?', [entity, attribute], function(err, result) {\n                if (err) { callback.call(self,err); return; }\n                if (result.length===0) {\n                    //get max value by querying the given entity\n                    const q = QueryExpression.create(entity).select(QueryField.create().max(attribute));\n                    self.execute(q,null, function(err, result) {\n                        if (err) { callback.call(self, err); return; }\n                        let value = 1;\n                        if (result.length>0) {\n                            value = (parseInt(result[0][attribute]) || 0)+ 1;\n                        }\n                        self.execute('INSERT INTO increment_id(entity, attribute, value) VALUES (?,?,?)',[entity, attribute, value], function(err) {\n                            //throw error if any\n                            if (err) { callback.call(self, err); return; }\n                            //return new increment value\n                            callback.call(self, err, value);\n                        });\n                    });\n                }\n                else {\n                    //get new increment value\n                    const value = parseInt(result[0].value) + 1;\n                    self.execute('UPDATE increment_id SET value=? WHERE id=?',[value, result[0].id], function(err) {\n                        //throw error if any\n                        if (err) { callback.call(self, err); return; }\n                        //return new increment value\n                        callback.call(self, err, value);\n                    });\n                }\n            });\n        });\n    }\n\n    /**\n     * Executes an operation against database and returns the results.\n     * @param {*} batch\n     * @param {function(Error=)} callback\n     */\n    executeBatch(batch, callback) {\n        callback = callback || function() {};\n        callback(new Error('DataAdapter.executeBatch() is obsolete. Use DataAdapter.executeInTransaction() instead.'));\n    }\n\n    table(name) {\n        const self = this;\n        return {\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            exists:function(callback) {\n                self.execute('SELECT COUNT(*) count FROM sqlite_master WHERE name=? AND type=\\'table\\';', [name], function(err, result) {\n                    if (err) { callback(err); return; }\n                    callback(null, (result[0].count>0));\n                });\n            },\n            /**\n             * @param {function(Error,string=)} callback\n             */\n            version:function(callback) {\n                self.execute('SELECT MAX(version) AS version FROM migrations WHERE appliesTo=?',\n                    [name], function(err, result) {\n                        if (err) { cb(err); return; }\n                        if (result.length === 0)\n                            callback(null, '0.0');\n                        else\n                            callback(null, result[0].version || '0.0');\n                    });\n            },\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            has_sequence:function(callback) {\n                callback = callback || function() {};\n                self.execute('SELECT COUNT(*) count FROM sqlite_sequence WHERE name=?',\n                    [name], function(err, result) {\n                        if (err) { callback(err); return; }\n                        callback(null, (result[0].count>0));\n                    });\n            },\n            /**\n             * @param {function(Error=,Array=)} callback\n             */\n            columns:function(callback) {\n                callback = callback || function() {};\n                self.execute('PRAGMA table_info(?)',\n                    [name], function(err, result) {\n                        if (err) { callback(err); return; }\n                        const arr = [];\n                        /**\n                         * enumerates table columns\n                         * @param {{name:string},{cid:number},{type:string},{notnull:number},{pk:number}} x\n                         */\n                        const iterator = function(x) {\n                            const col = { name: x.name, ordinal: x.cid, type: x.type,nullable: (x.notnull ? true : false), primary: (x.pk==1) };\n                            const matches = /(\\w+)\\((\\d+),(\\d+)\\)/.exec(x.type);\n                            if (matches) {\n                                //extract max length attribute (e.g. integer(2,0) etc)\n                                if (parseInt(matches[2])>0) { col.size =  parseInt(matches[2]); }\n                                //extract scale attribute from field (e.g. integer(2,0) etc)\n                                if (parseInt(matches[3])>0) { col.scale =  parseInt(matches[3]); }\n                            }\n                            arr.push(col);\n                        };\n                        result.forEach(iterator);\n                        callback(null, arr);\n                    });\n            }\n        }\n\n    }\n\n    view(name) {\n        const self = this;\n        return {\n            /**\n             * @param {function(Error,Boolean=)} callback\n             */\n            exists:function(callback) {\n                self.execute('SELECT COUNT(*) count FROM sqlite_master WHERE name=? AND type=\\'view\\';', [name], function(err, result) {\n                    if (err) { callback(err); return; }\n                    callback(null, (result[0].count>0));\n                });\n            },\n            /**\n             * @param {function(Error=)} callback\n             */\n            drop:function(callback) {\n                callback = callback || function() {};\n                self.open(function(err) {\n                   if (err) { callback(err); return; }\n                    const sql = util.format(\"DROP VIEW IF EXISTS %s\",name);\n                    self.execute(sql, undefined, function(err) {\n                        if (err) { callback(err); return; }\n                        callback();\n                    });\n                });\n            },\n            /**\n             * @param {QueryExpression|*} q\n             * @param {function(Error=)} callback\n             */\n            create:function(q, callback) {\n                const thisArg = this;\n                self.executeInTransaction(function(tr) {\n                    thisArg.drop(function(err) {\n                        if (err) { tr(err); return; }\n                        try {\n                            let sql = util.format(\"CREATE VIEW %s AS \",name);\n                            const formatter = new SqliteFormatter();\n                            sql += formatter.format(q);\n                            self.execute(sql, undefined, tr);\n                        }\n                        catch(e) {\n                            tr(e);\n                        }\n                    });\n                }, function(err) {\n                    callback(err);\n                });\n\n            }\n        };\n    }\n\n    /**\n     * Executes a query against the underlying database\n     * @param query {QueryExpression|string|*}\n     * @param values {*=}\n     * @param {function(Error=,*=)} callback\n     */\n    execute(query, values, callback) {\n        const self = this;\n        let sql = null;\n        try {\n\n            if (typeof query === 'string') {\n                //get raw sql statement\n                sql = query;\n            }\n            else {\n                //format query expression or any object that may be act as query expression\n                const formatter = new SqliteFormatter();\n                sql = formatter.format(query);\n            }\n            //validate sql statement\n            if (typeof sql !== 'string') {\n                callback.call(self, new Error('The executing command is of the wrong type or empty.'));\n                return;\n            }\n            //ensure connection\n            self.open(function(err) {\n                if (err) {\n                    callback.call(self, err);\n                }\n                else {\n                    //log statement (optional)\n                    if (process.env.NODE_ENV==='development')\n                        console.log(util.format('SQL:%s, Parameters:%s', sql, JSON.stringify(values)));\n\n                    //prepare statement - the traditional way\n                    const prepared = self.prepare(sql, values);\n\n                    let fn;\n                    //validate statement\n                    if (/^(SELECT|PRAGMA)/ig.test(prepared)) {\n                        //prepare for select\n                        fn = self.rawConnection.all;\n                    }\n                    else {\n                        //otherwise prepare for run\n                        fn = self.rawConnection.run;\n                    }\n                    //execute raw command\n                    fn.call(self.rawConnection, prepared, [] , function(err, result) {\n                        if (err) {\n                            //log sql\n                            console.log(util.format('SQL Error:%s', prepared));\n                            callback(err);\n                        }\n                        else {\n                            if (result) {\n                                if (typeof result === 'object') {\n                                    let keys;\n                                    if (util.isArray(result)) {\n                                        if (result.length>0) {\n                                            keys = Object.keys(result[0]);\n                                            result.forEach(function(x) {\n                                                keys.forEach(function(y) {\n                                                    if (x[y] === null) { delete x[y]; }\n                                                });\n                                            });\n                                        }\n                                    }\n                                    else {\n                                        keys = Object.keys(result);\n                                        keys.forEach(function(y) {\n                                            if (result[y] === null) { delete result[y]; }\n                                        });\n                                    }\n                                }\n                                return callback(null, result);\n                            }\n                            else {\n                                return callback();\n                            }\n\n                        }\n                    });\n                }\n            });\n        }\n        catch (e) {\n            callback.call(self, e);\n        }\n    }\n\n    lastIdentity(callback) {\n        const self = this;\n        self.open(function(err) {\n            if (err) {\n                callback(err);\n            }\n            else {\n                //execute lastval (for sequence)\n                self.execute('SELECT last_insert_rowid() as lastval', [], function(err, lastval) {\n                    if (err) {\n                        callback(null, { insertId: null });\n                    }\n                    else {\n                        lastval = lastval || [];\n                        if (lastval.length>0)\n                            callback(null, { insertId:lastval[0]['lastval'] });\n                        else\n                            callback(null, { insertId: null });\n                    }\n                });\n            }\n        });\n    }\n\n    indexes(table) {\n        const self = this, formatter = new SqliteFormatter();\n        return {\n            list: function (callback) {\n                const this1 = this;\n                if (this1.hasOwnProperty('indexes_')) {\n                    return callback(null, this1['indexes_']);\n                }\n                self.execute(util.format('PRAGMA INDEX_LIST(`%s`)', table), null , function (err, result) {\n                    if (err) { return callback(err); }\n                    const indexes = result.filter(function(x) {\n                        return x.origin === 'c';\n                    }).map(function(x) {\n                        return {\n                            name:x.name,\n                            columns:[]\n                        }\n                    });\n                    async.eachSeries(indexes, function(index, cb) {\n                        self.execute(util.format('PRAGMA INDEX_INFO(`%s`)', index.name), function(err, columns) {\n                           if (err) { return cb(err); }\n                            index.columns = columns.map(function(x) {\n                                return x.name;\n                            })\n                        });\n                    }, function(err) {\n                        if (err) {\n                            return callback(err);\n                        }\n                        this1['indexes_'] = indexes;\n                        return callback(null, indexes);\n                    });\n                });\n            },\n            /**\n             * @param {string} name\n             * @param {Array|string} columns\n             * @param {Function} callback\n             */\n            create: function(name, columns, callback) {\n                const cols = [];\n                if (typeof columns === 'string') {\n                    cols.push(columns)\n                }\n                else if (util.isArray(columns)) {\n                    cols.push.apply(cols, columns);\n                }\n                else {\n                    return callback(new Error(\"Invalid parameter. Columns parameter must be a string or an array of strings.\"));\n                }\n\n                this.list(function(err, indexes) {\n                    if (err) { return callback(err); }\n                    const ix = indexes.find(function(x) { return x.name === name; });\n                    //format create index SQL statement\n                    const sqlCreateIndex = util.format(\"CREATE INDEX %s ON %s(%s)\",\n                        formatter.escapeName(name),\n                        formatter.escapeName(table),\n                        cols.map(function(x) {\n                            return formatter.escapeName(x)\n                        }).join(\",\"));\n                    if (typeof ix === 'undefined' || ix === null) {\n                        self.execute(sqlCreateIndex, [], callback);\n                    }\n                    else {\n                        let nCols = cols.length;\n                        //enumerate existing columns\n                        ix.columns.forEach(function(x) {\n                            if (cols.indexOf(x)>=0) {\n                                //column exists in index\n                                nCols -= 1;\n                            }\n                        });\n                        if (nCols>0) {\n                            //drop index\n                            this.drop(name, function(err) {\n                                if (err) { return callback(err); }\n                                //and create it\n                                self.execute(sqlCreateIndex, [], callback);\n                            });\n                        }\n                        else {\n                            //do nothing\n                            return callback();\n                        }\n                    }\n                });\n\n\n            },\n            drop: function(name, callback) {\n                if (typeof name !== 'string') {\n                    return callback(new Error(\"Name must be a valid string.\"))\n                }\n                self.execute(util.format('PRAGMA INDEX_LIST(`%s`)', table), null, function(err, result) {\n                    if (err) { return callback(err); }\n                    const exists = typeof result.find(function(x) { return x.name===name }) !== 'undefined';\n                    if (!exists) {\n                        return callback();\n                    }\n                    self.execute(util.format(\"DROP INDEX %s\", self.escapeName(name)), [], callback);\n                });\n            }\n        }\n    }\n}\n\nfunction zeroPad(number, length) {\n    number = number || 0;\n    let res = number.toString();\n    while (res.length < length) {\n        res = '0' + res;\n    }\n    return res;\n}\n\n/**\n * @augments {SqlFormatter}\n */\nexport class SqliteFormatter extends SqlFormatter {\n    /**\n     * @constructor\n     */\n    constructor() {\n        super();\n        this.settings = {\n            nameFormat:SqliteFormatter.NAME_FORMAT,\n            forceAlias:true\n        }\n    }\n\n    escapeName(name) {\n        if (typeof name === 'string')\n            return name.replace(/(\\w+)/ig, this.settings.nameFormat);\n        return name;\n    }\n\n    /**\n     * Escapes an object or a value and returns the equivalent sql value.\n     * @param {*} value - A value that is going to be escaped for SQL statements\n     * @param {boolean=} unquoted - An optional value that indicates whether the resulted string will be quoted or not.\n     * returns {string} - The equivalent SQL string value\n     */\n    escape(value, unquoted) {\n        if (typeof value === 'boolean') { return value ? '1' : '0'; }\n        if (value instanceof Date) {\n            return this.escapeDate(value);\n        }\n        let res = super.escape.bind(this)(value, unquoted);\n        if (typeof value === 'string') {\n            if (REGEXP_SINGLE_QUOTE.test(res))\n            //escape single quote (that is already escaped)\n                res = res.replace(/\\\\'/g, SINGLE_QUOTE_ESCAPE);\n            if (REGEXP_DOUBLE_QUOTE.test(res))\n            //escape double quote (that is already escaped)\n                res = res.replace(/\\\\\"/g, DOUBLE_QUOTE_ESCAPE);\n            if (REGEXP_SLASH.test(res))\n            //escape slash (that is already escaped)\n                res = res.replace(/\\\\\\\\/g, SLASH_ESCAPE);\n        }\n        return res;\n    }\n\n    /**\n     * @param {Date|*} val\n     * @returns {string}\n     */\n    escapeDate(val) {\n        const year   = val.getFullYear();\n        const month  = zeroPad(val.getMonth() + 1, 2);\n        const day    = zeroPad(val.getDate(), 2);\n        const hour   = zeroPad(val.getHours(), 2);\n        const minute = zeroPad(val.getMinutes(), 2);\n        const second = zeroPad(val.getSeconds(), 2);\n        const millisecond = zeroPad(val.getMilliseconds(), 3);\n        //format timezone\n        const offset = val.getTimezoneOffset(), timezone = (offset<=0 ? '+' : '-') + zeroPad(-Math.floor(offset/60),2) + ':' + zeroPad(offset%60,2);\n        return \"'\" + year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second + \".\" + millisecond + timezone + \"'\";\n    }\n\n    /**\n     * Implements indexOf(str,substr) expression formatter.\n     * @param {string} p0 The source string\n     * @param {string} p1 The string to search for\n     * @returns {string}\n     */\n    $indexof(p0, p1) {\n        return util.format('(INSTR(%s,%s)-1)', this.escape(p0), this.escape(p1));\n    }\n\n    /**\n     * Implements indexOf(str,substr) expression formatter.\n     * @param {string} p0 The source string\n     * @param {string} p1 The string to search for\n     * @returns {string}\n     */\n    $indexOf(p0, p1) {\n        return util.format('(INSTR(%s,%s)-1)', this.escape(p0), this.escape(p1));\n    }\n\n    /**\n     * Implements contains(a,b) expression formatter.\n     * @param {*} p0 The source string\n     * @param {*} p1 The string to search for\n     * @returns {string}\n     */\n    $text(p0, p1) {\n        return util.format('(INSTR(%s,%s)-1)>=0', this.escape(p0), this.escape(p1));\n    }\n\n    /**\n     * Implements simple regular expression formatter. Important Note: SQLite 3 does not provide a core sql function for regular expression matching.\n     * @param {*} p0 The source string or field\n     * @param {*} p1 The string to search for\n     */\n    $regex(p0, p1) {\n        //escape expression\n        let s1 = this.escape(p1, true);\n        //implement starts with equivalent for LIKE T-SQL\n        if (/^\\^/.test(s1)) {\n            s1 = s1.replace(/^\\^/,'');\n        }\n        else {\n            s1 = '%' + s1;\n        }\n        //implement ends with equivalent for LIKE T-SQL\n        if (/\\$$/.test(s1)) {\n            s1 = s1.replace(/\\$$/,'');\n        }\n        else {\n            s1 += '%';\n        }\n        return util.format('LIKE(\\'%s\\',%s) >= 1',s1, this.escape(p0));\n    }\n\n    /**\n     * Implements concat(a,b) expression formatter.\n     * @param {*} p0\n     * @param {*} p1\n     * @returns {string}\n     */\n    $concat(p0, p1) {\n        return util.format('(IFNULL(%s,\\'\\') || IFNULL(%s,\\'\\'))', this.escape(p0),  this.escape(p1));\n    }\n\n    /**\n     * Implements substring(str,pos) expression formatter.\n     * @param {String} p0 The source string\n     * @param {Number} pos The starting position\n     * @param {Number=} length The length of the resulted string\n     * @returns {string}\n     */\n    $substring(p0, pos, length) {\n        if (length)\n            return util.format('SUBSTR(%s,%s,%s)', this.escape(p0), pos.valueOf()+1, length.valueOf());\n        else\n            return util.format('SUBSTR(%s,%s)', this.escape(p0), pos.valueOf()+1);\n    }\n\n    /**\n     * Implements substring(str,pos) expression formatter.\n     * @param {String} p0 The source string\n     * @param {Number} pos The starting position\n     * @param {Number=} length The length of the resulted string\n     * @returns {string}\n     */\n    $substr(p0, pos, length) {\n        if (length)\n            return util.format('SUBSTR(%s,%s,%s)', this.escape(p0), pos.valueOf()+1, length.valueOf());\n        else\n            return util.format('SUBSTR(%s,%s)', this.escape(p0), pos.valueOf()+1);\n    }\n\n    /**\n     * Implements length(a) expression formatter.\n     * @param {*} p0\n     * @returns {string}\n     */\n    $length(p0) {\n        return util.format('LENGTH(%s)', this.escape(p0));\n    }\n\n    $ceiling(p0) {\n        return util.format('CEIL(%s)', this.escape(p0));\n    }\n\n    $startswith(p0, p1) {\n        //validate params\n        if (_.isNil(p0) || _.isNil(p1))\n            return '';\n        return 'LIKE(\\'' + this.escape(p1, true) + '%\\',' + this.escape(p0) + ')';\n    }\n\n    $contains(p0, p1) {\n        //validate params\n        if (_.isNil(p0) || _.isNil(p1))\n            return '';\n        return 'LIKE(\\'%' + this.escape(p1, true) + '%\\',' + this.escape(p0) + ')';\n    }\n\n    $endswith(p0, p1) {\n        //validate params\n        if (_.isNil(p0) || _.isNil(p1))\n            return '';\n        return 'LIKE(\\'%' + this.escape(p1, true) + '\\',' + this.escape(p0) + ')';\n    }\n\n    $day(p0) { return 'CAST(strftime(\\'%d\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $dayOfMonth(p0) { return 'CAST(strftime(\\'%d\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $month(p0) { return 'CAST(strftime(\\'%m\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $year(p0) { return 'CAST(strftime(\\'%Y\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $hour(p0) { return 'CAST(strftime(\\'%H\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $minute(p0) { return 'CAST(strftime(\\'%M\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $second(p0) { return 'CAST(strftime(\\'%S\\', ' + this.escape(p0) + ') AS INTEGER)'; }\n    $date(p0) { return 'date(' + this.escape(p0) + ')'; }\n}\n\nSqliteFormatter.NAME_FORMAT = '`$1`';\n\nconst REGEXP_SINGLE_QUOTE=/\\\\'/g, SINGLE_QUOTE_ESCAPE ='\\'\\'',\n    REGEXP_DOUBLE_QUOTE=/\\\\\"/g, DOUBLE_QUOTE_ESCAPE = '\"',\n    REGEXP_SLASH=/\\\\\\\\/g, SLASH_ESCAPE = '\\\\';\n\n/**\n * Creates an instance of SqliteAdapter object that represents a sqlite database connection.\n * @param {*} options An object that represents the properties of the underlying database connection.\n * @returns {DataAdapter|*}\n */\nexport function createInstance(options) {\n    return new SqliteAdapter(options);\n}\n\n"]}