{"version":3,"sources":["index.es6"],"names":["createInstance","oracledb","async","util","_","SqlFormatter","TraceUtils","LangUtils","SqlUtils","QueryField","OracleAdapter","options","host","rawConnection","connectString","Object","defineProperty","get","port","service","type","instance","callback","self","debug","getConnection","user","password","err","connection","release","query","values","format","fn","open","transaction","call","rollback","commit","name","view","create","obj","migration","result","test","replace","formatType","waterfall","cb","supportMigrations","table","exists","arg","eachSeries","s","cb0","execute","appliesTo","version","add","column","newType","oldType","isArray","remove","length","Error","change","columns","x","i","find","y","primary","splice","precision","scale","toUpperCase","toString","nullable","size","push","targetTable","model","description","entity","attribute","substring","owner","schema","sql","selectIdentity","batch","matches","exec","count","hasSequence","fields","strFields","map","filter","oneToMany","join","strTable","formatter","OracleFormatter","escapeName","strPKFields","res","parseBoolean","drop","undefined","q","thisArg","executeInTransaction","tr","e","process","env","NODE_ENV","log","JSON","stringify","prepared","prepare","outFormat","OBJECT","autoCommit","rows","field","parseInt","concat","zeroPad","number","settings","nameFormat","NAME_FORMAT","forceAlias","useAliasKeyword","value","unquoted","Date","escapeDate","isDate","bind","SINGLE_QUOTE_ESCAPE","DOUBLE_QUOTE_ESCAPE","SLASH_ESCAPE","val","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","offset","getTimezoneOffset","timezone","Math","floor","getMilliseconds","take","$take","skip","$skip","formatSelect","keys","$select","selectFields","order","$order","$row_index","subQuery","pop","forEach","assign","as","getName","p0","p1","escape","pos","valueOf","args","Array","prototype","slice","arguments","isNil"],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * @license\r\n * MOST Web Framework 2.0 Codename Blueshift\r\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\r\n *                     Anthi Oikonomou anthioikonomou@gmail.com\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport oracledb from 'oracledb';\r\nimport async from 'async';\r\nimport util from 'util';\r\nimport _ from 'lodash';\r\nimport {SqlFormatter} from '@themost/query/formatter';\r\nimport {TraceUtils,LangUtils} from \"@themost/common/utils\";\r\nimport {SqlUtils} from \"@themost/query/utils\";\r\nimport {QueryField} from \"@themost/query/query\";\r\n\r\n\r\n/**\r\n * @class\r\n * @augments DataAdapter\r\n * @property {string} connectString\r\n */\r\nexport class OracleAdapter {\r\n    /**\r\n     * @constructor\r\n     * @param {*} options\r\n     */\r\n    constructor(options) {\r\n        this.options = options || { host:'localhost' };\r\n        /**\r\n         * Represents the database raw connection associated with this adapter\r\n         * @type {*}\r\n         */\r\n        this.rawConnection = null;\r\n        let connectString;\r\n        //of options contains connectString parameter ignore all other params and define this as the database connection string\r\n        if (options.connectString) { connectString = options.connectString; }\r\n        Object.defineProperty(this, 'connectString', {\r\n            get: function() {\r\n                if (typeof connectString === 'string') {\r\n                    return connectString;\r\n                }\r\n                else {\r\n                    //generate connectString ([//]host_name[:port][/service_name][:server_type][/instance_name])\r\n                    //get hostname or localhost\r\n                    connectString = options.host || 'localhost';\r\n                    //append port\r\n                    if (typeof options.port !== 'undefined') { connectString += ':' + options.port; }\r\n                    if (typeof options.service !== 'undefined') { connectString += '/' + options.service; }\r\n                    if (typeof options.type !== 'undefined') { connectString += ':' + options.type; }\r\n                    if (typeof options.instance !== 'undefined') { connectString += '/' + options.instance; }\r\n                    return connectString;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    open(callback) {\r\n        const self = this;\r\n        callback = callback || function() {};\r\n        if (self.rawConnection) {\r\n            callback();\r\n        }\r\n        else {\r\n            TraceUtils.debug('Opening database connection');\r\n            oracledb.getConnection(\r\n                {\r\n                    user          : this.options.user,\r\n                    password      : this.options.password,\r\n                    connectString : this.connectString\r\n                }, function(err, connection) {\r\n                    if (err) { return callback(err); }\r\n                    TraceUtils.debug('Open database connection');\r\n                    self.rawConnection = connection;\r\n                    callback();\r\n                });\r\n        }\r\n    }\r\n\r\n    close(callback) {\r\n        const self = this;\r\n        callback = callback || function() {};\r\n        try {\r\n            if (self.rawConnection)\r\n            {\r\n                TraceUtils.debug('Closing database connection');\r\n                //close connection\r\n                self.rawConnection.release(function(err) {\r\n                    if (err) {\r\n                        TraceUtils.debug('An error occured while closing database connection.');\r\n                        TraceUtils.debug(err);\r\n                    }\r\n                    TraceUtils.debug('Close database connection');\r\n                    //destroy raw connection\r\n                    self.rawConnection=null;\r\n                    //and finally return\r\n                    return callback();\r\n                });\r\n            }\r\n            else {\r\n                return callback();\r\n            }\r\n\r\n        }\r\n        catch (err) {\r\n            TraceUtils.debug('An error occured while closing database connection');\r\n            TraceUtils.debug(err);\r\n            //call callback without error\r\n            callback();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {string} query\r\n     * @param {*=} values\r\n     */\r\n    prepare(query, values) {\r\n        return SqlUtils.format(query,values);\r\n    }\r\n\r\n    static formatType(field) {\r\n        const size = parseInt(field.size);\r\n        let s;\r\n        switch (field.type)\r\n        {\r\n            case 'Boolean':\r\n                s = 'NUMBER(1,0)';\r\n                break;\r\n            case 'Byte':\r\n                s = 'NUMBER(3,0)';\r\n                break;\r\n            case 'Number':\r\n                s = 'NUMBER(38,0)';\r\n                break;\r\n            case 'Float':\r\n                s = 'NUMBER(19,4)';\r\n                break;\r\n            case 'Counter':\r\n                return 'NUMBER(19,0)';\r\n            case 'Currency':\r\n                s =  'NUMBER(' + (field.size || 19) + ',4)';\r\n                break;\r\n            case 'Decimal':\r\n                s =  'NUMBER';\r\n                if ((field.size) && (field.scale)) {\r\n                    s += '(' + field.size + ',' + field.scale + ')';\r\n                }\r\n                else {\r\n                    s += '(19,4)';\r\n                }\r\n                break;\r\n            case 'Date':\r\n            case 'DateTime':\r\n                s = 'TIMESTAMP(6) WITH LOCAL TIME ZONE';\r\n                break;\r\n            case 'Time':\r\n                s = 'NUMBER(19,4)';\r\n                break;\r\n            case 'Long':\r\n                s = 'NUMBER(19,0)';\r\n                break;\r\n            case 'Duration':\r\n                s =field.size ? util.format('NVARCHAR2(%s)', field.size) : 'NVARCHAR2(48)';\r\n                break;\r\n            case 'Integer':\r\n                s = 'NUMBER' + (field.size ? '(' + field.size + ',0)':'(19,0)' );\r\n                break;\r\n            case 'URL':\r\n            case 'Text':\r\n            case 'Note':\r\n                s =field.size ? util.format('NVARCHAR2(%s)', field.size) : 'NVARCHAR2(255)';\r\n                break;\r\n            case 'Image':\r\n            case 'Binary':\r\n                s ='LONG RAW';\r\n                break;\r\n            case 'Guid':\r\n                s = 'VARCHAR2(36)';\r\n                break;\r\n            case 'Short':\r\n                s = 'NUMBER(5,0)';\r\n                break;\r\n            default:\r\n                s = 'NUMBER(19,0)';\r\n                break;\r\n        }\r\n        if (field.primary) {\r\n            return s.concat(' NOT NULL');\r\n        }\r\n        else {\r\n            return s.concat((typeof field.nullable=== 'undefined' || field.nullable === null) ? ' NULL': (field.nullable ? ' NULL': ' NOT NULL'));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Begins a transactional operation by executing the given function\r\n     * @param fn {function} The function to execute\r\n     * @param callback {function(Error=)} The callback that contains the error -if any- and the results of the given operation\r\n     */\r\n    executeInTransaction(fn, callback) {\r\n        const self = this;\r\n        //ensure parameters\r\n        fn = fn || function() {}; callback = callback || function() {};\r\n        self.open(function(err) {\r\n            if (err) {\r\n                callback(err);\r\n            }\r\n            else {\r\n                if (self.transaction) {\r\n                    fn.call(self, function(err) {\r\n                        callback(err);\r\n                    });\r\n                }\r\n                else {\r\n                    //initialize dummy transaction object (for future use)\r\n                    self.transaction = { };\r\n                    //execute function\r\n                    fn.call(self, function(err) {\r\n                        if (err) {\r\n                            //rollback transaction\r\n                            self.rawConnection.rollback(function() {\r\n                                delete self.transaction;\r\n                                callback(err);\r\n                            });\r\n                        }\r\n                        else {\r\n                            //commit transaction\r\n                            self.rawConnection.commit(function(err) {\r\n                                delete self.transaction;\r\n                                callback(err);\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} name\r\n     * @param {QueryExpression|*} query\r\n     * @param {function(Error=)} callback\r\n     */\r\n    createView(name, query, callback) {\r\n        this.view(name).create(query, callback);\r\n    }\r\n\r\n    /*\r\n     * @param {DataModelMigration|*} obj An Object that represents the data model scheme we want to migrate\r\n     * @param {function(Error=)} callback\r\n     */\r\n    migrate(obj, callback) {\r\n        const self = this;\r\n        callback = callback || function() {};\r\n        if (typeof obj === 'undefined' || obj === null) { callback(); return; }\r\n        /**\r\n         * @type {DataModelMigration|*}\r\n         */\r\n        const migration = obj;\r\n\r\n        const format = function(format, obj)\r\n        {\r\n            let result = format;\r\n            if (/%t/.test(format))\r\n                result = result.replace(/%t/g,OracleAdapter.formatType(obj));\r\n            if (/%f/.test(format))\r\n                result = result.replace(/%f/g,obj.name);\r\n            return result;\r\n        };\r\n\r\n\r\n        async.waterfall([\r\n            //1. Check migrations table existence\r\n            function(cb) {\r\n                if (OracleAdapter.supportMigrations) {\r\n                    cb(null, true);\r\n                    return;\r\n                }\r\n                self.table('migrations').exists(function(err, exists) {\r\n                    if (err) { cb(err); return; }\r\n                    cb(null, exists);\r\n                });\r\n            },\r\n            //2. Create migrations table, if it does not exist\r\n            function(arg, cb) {\r\n                if (arg) { cb(null, 0); return; }\r\n                //create migrations table\r\n\r\n                async.eachSeries([\r\n                    'CREATE TABLE \"migrations\"(\"id\" NUMBER(10) NOT NULL, \"appliesTo\" NVARCHAR2(255) NOT NULL, \"model\" NVARCHAR2(255) NULL, ' +\r\n                    '\"description\" NVARCHAR2(255),\"version\" NVARCHAR2(24) NOT NULL, CONSTRAINT \"migrations_pk\" PRIMARY KEY (\"id\"))',\r\n                    'CREATE SEQUENCE \"migrations_id_seq\" START WITH 1 INCREMENT BY 1'\r\n                ], function(s, cb0) {\r\n                    self.execute(s, [], cb0);\r\n                }, function(err) {\r\n                    if (err) { return cb(err); }\r\n                    OracleAdapter.supportMigrations=true;\r\n                    return cb(null, 0);\r\n                });\r\n\r\n                //self.execute('CREATE TABLE \"migrations\"(\"id\" NUMBER(10) NOT NULL, ' +\r\n                //    '\"appliesTo\" NVARCHAR2(255) NOT NULL, \"model\" NVARCHAR2(255) NULL, ' +\r\n                //    '\"description\" NVARCHAR2(255),\"version\" NVARCHAR2(24) NOT NULL, ' +\r\n                //    'CONSTRAINT \"migrations_pk\" PRIMARY KEY (\"id\")); ' +\r\n                //    'CREATE SEQUENCE \"migrations_seq\" START WITH 1 INCREMENT BY 1; ' +\r\n                //    'CREATE TRIGGER \"migrations_auto_inc\" BEFORE INSERT ON \"migrations\" FOR EACH ROW BEGIN :new.\"id\" := \"migrations_seq\".nextval; END;',\r\n                //    [], function(err) {\r\n                //        if (err) { cb(err); return; }\r\n                //        OracleAdapter.supportMigrations=true;\r\n                //        cb(null, 0);\r\n                //    });\r\n            },\r\n            //3. Check if migration has already been applied (true=Table version is equal to migration version, false=Table version is older from migration version)\r\n            function(arg, cb) {\r\n                self.table(migration.appliesTo).version(function(err, version) {\r\n                    if (err) { cb(err); return; }\r\n                    cb(null, (version>=migration.version));\r\n                });\r\n            },\r\n            //4a. Check table existence (-1=Migration has already been applied, 0=Table does not exist, 1=Table exists)\r\n            function(arg, cb) {\r\n                //migration has already been applied (set migration.updated=true)\r\n                if (arg) {\r\n                    migration['updated']=true;\r\n                    cb(null, -1);\r\n                }\r\n                else {\r\n                    self.table(migration.appliesTo).exists(function(err, exists) {\r\n                        if (err) { cb(err); return; }\r\n                        cb(null, exists ? 1 : 0);\r\n                    });\r\n                }\r\n            },\r\n            //5. Migrate target table (create or alter)\r\n            function(arg, cb) {\r\n                //migration has already been applied (args[0]=-1)\r\n                if (arg < 0) {\r\n                    cb(null, arg);\r\n                }\r\n                else if (arg === 0) {\r\n                    self.table(migration.appliesTo).create(migration.add, function(err) {\r\n                        if (err) { return cb(err); }\r\n                        cb(null, 1);\r\n                    });\r\n                }\r\n                else if (arg === 1) {\r\n                    let column, newType, oldType;\r\n\r\n                    //1. columns to be removed\r\n                    if (_.isArray(migration.remove)) {\r\n                        if (migration.remove.length>0) {\r\n                            return cb(new Error('Data migration remove operation is not supported by this adapter.'));\r\n                        }\r\n                    }\r\n                    //1. columns to be changed\r\n                    if (_.isArray(migration.change)) {\r\n                        if (migration.change.length>0) {\r\n                            return cb(new Error('Data migration change operation is not supported by this adapter. Use add collection instead.'));\r\n                        }\r\n                    }\r\n\r\n                    if (_.isArray(migration.add)) {\r\n                        //init change collection\r\n                        migration.change = [];\r\n                        //get table columns\r\n                        self.table(migration.appliesTo).columns(function(err, columns) {\r\n                            if (err) { return cb(err); }\r\n                            for (let i = 0; i < migration.add.length; i++) {\r\n                                const x = migration.add[i];\r\n                                column = _.find(columns, (y)=> {\r\n                                    return y.name === x.name;\r\n                                });\r\n                                if (column) {\r\n                                    //if column is primary key remove it from collection\r\n                                    if (column.primary) {\r\n                                        migration.add.splice(i, 1);\r\n                                        i-=1;\r\n                                    }\r\n                                    else {\r\n                                        newType = format('%t', x);\r\n                                        if (column.precision !== null && column.scale !== null) {\r\n                                            oldType = util.format('%s(%s,%s) %s', column.type.toUpperCase(), column.precision.toString(), column.scale.toString(), (column.nullable ? 'NULL' : 'NOT NULL'));\r\n                                        }\r\n                                        else if (/^TIMESTAMP\\(\\d+\\) WITH LOCAL TIME ZONE$/i.test(column.type)) {\r\n                                            oldType=util.format('%s %s', column.type.toUpperCase(), (column.nullable ? 'NULL' : 'NOT NULL'));\r\n                                        }\r\n                                        else if (column.size !== null) {\r\n                                            oldType = util.format('%s(%s) %s', column.type.toUpperCase(), column.size.toString(), (column.nullable ? 'NULL' : 'NOT NULL'));\r\n                                        }\r\n                                        else {\r\n                                            oldType = util.format('%s %s', column.type.toUpperCase(), (column.nullable ? 'NULL' : 'NOT NULL'));\r\n                                        }\r\n                                        //remove column from collection\r\n                                        migration.add.splice(i, 1);\r\n                                        i-=1;\r\n                                        if (newType !== oldType) {\r\n                                            //add column to alter collection\r\n                                            migration.change.push(x);\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            //alter table\r\n                            const targetTable = self.table(migration.appliesTo);\r\n                            //add new columns (if any)\r\n                            targetTable.add(migration.add, function(err) {\r\n                                if (err) { return cb(err); }\r\n                                //modify columns (if any)\r\n                                targetTable.change(migration.change, function(err) {\r\n                                    if (err) { return cb(err); }\r\n                                    cb(null, 1);\r\n                                });\r\n                            });\r\n                        });\r\n                    }\r\n                    else {\r\n                        cb(new Error('Invalid migration data.'));\r\n                    }\r\n                }\r\n                else {\r\n                    cb(new Error('Invalid table status.'));\r\n                }\r\n            },\r\n            function(arg, cb) {\r\n                if (arg>0) {\r\n                    //log migration to database\r\n                    self.execute('INSERT INTO \"migrations\"(\"id\",\"appliesTo\", \"model\", \"version\", \"description\") VALUES (\"migrations_id_seq\".nextval,?,?,?,?)', [migration.appliesTo,\r\n                        migration.model,\r\n                        migration.version,\r\n                        migration.description ], function(err) {\r\n                        if (err)  {\r\n                            return cb(err);\r\n                        }\r\n                        cb(null, 1);\r\n                    });\r\n                }\r\n                else {\r\n                    migration['updated'] = true;\r\n                    cb(null, arg);\r\n                }\r\n            }\r\n        ], function(err) {\r\n            callback(err);\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Produces a new identity value for the given entity and attribute.\r\n     * @param entity {String} The target entity name\r\n     * @param attribute {String} The target attribute\r\n     * @param callback {Function=}\r\n     */\r\n    selectIdentity(entity, attribute, callback) {\r\n\r\n        const self = this;\r\n        //format sequence name ([entity]_[attribute]_seg e.g. user_id_seq)\r\n        let name = entity + \"_\" + attribute + \"_seq\";\r\n        if (name.length>30)\r\n        {\r\n            name=entity.substring(0,26) + \"_seq\";\r\n        }\r\n        let owner;\r\n        if (self.options && self.options.schema) {\r\n            owner = self.options.schema;\r\n        }\r\n        let sql ='SELECT SEQUENCE_OWNER,SEQUENCE_NAME FROM ALL_SEQUENCES WHERE \"SEQUENCE_NAME\" = ?';\r\n        if (owner) {\r\n            sql += ' AND REGEXP_LIKE(SEQUENCE_OWNER,?,\\'i\\')';\r\n        }\r\n        //search for sequence\r\n        self.execute(sql, [ name, owner ? '^' + owner + '$' : null ], function(err, result) {\r\n            if (err) { return callback(err); }\r\n            if (result.length===0) {\r\n                self.execute(util.format('CREATE SEQUENCE \"%s\" START WITH 1 INCREMENT BY 1', name), [], function(err) {\r\n                    if (err) { return callback(err); }\r\n                    //get next value\r\n                    self.execute(util.format('SELECT \"%s\".nextval AS \"resultId\" FROM DUAL', name), [], function(err, result) {\r\n                        if (err) { return callback(err); }\r\n                        callback(null, result[0]['resultId']);\r\n                    });\r\n                });\r\n            }\r\n            else {\r\n                //get next value\r\n                self.execute(util.format('SELECT \"%s\".nextval AS \"resultId\" FROM DUAL', name), [], function(err, result) {\r\n                    if (err) { return callback(err); }\r\n                    callback(null, result[0]['resultId']);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Produces a new counter auto increment value for the given entity and attribute.\r\n     * @param entity {String} The target entity name\r\n     * @param attribute {String} The target attribute\r\n     * @param callback {Function=}\r\n     */\r\n    nextIdentity(entity, attribute, callback) {\r\n        this.selectIdentity(entity, attribute , callback);\r\n    }\r\n\r\n    /**\r\n     * Executes an operation against database and returns the results.\r\n     * @param {*} batch\r\n     * @param {function(Error=)} callback\r\n     */\r\n    executeBatch(batch, callback) {\r\n        callback = callback || function() {};\r\n        callback(new Error('DataAdapter.executeBatch() is obsolete. Use DataAdapter.executeInTransaction() instead.'));\r\n    }\r\n\r\n    table(name) {\r\n        const self = this;\r\n        let owner;\r\n        let table;\r\n        const matches = /(\\w+)\\.(\\w+)/.exec(name);\r\n        if (matches) {\r\n            //get schema owner (the first part of the string provided)\r\n            owner = matches[1];\r\n            //get table name (the second part of the string provided)\r\n            table = matches[2];\r\n        }\r\n        else {\r\n            //get table name (the whole string provided)\r\n            table = name;\r\n            //get schema name (from options)\r\n            if (self.options && self.options.schema) {\r\n                owner = self.options.schema;\r\n            }\r\n        }\r\n\r\n        const format = function(format, obj)\r\n        {\r\n            let result = format;\r\n            if (/%t/.test(format))\r\n                result = result.replace(/%t/g,OracleAdapter.formatType(obj));\r\n            if (/%f/.test(format))\r\n                result = result.replace(/%f/g,obj.name);\r\n            return result;\r\n        };\r\n\r\n        return {\r\n            /**\r\n             * @param {function(Error,Boolean=)} callback\r\n             */\r\n            exists:function(callback) {\r\n                let sql;\r\n                if (typeof owner === 'undefined' || owner === null) {\r\n                    sql = 'SELECT COUNT(*) AS \"count\" FROM ALL_OBJECTS WHERE object_type IN (\\'TABLE\\') AND object_name = ?';\r\n                }\r\n                else {\r\n                    sql = 'SELECT COUNT(*) AS \"count\" FROM ALL_OBJECTS WHERE object_type IN (\\'TABLE\\') AND object_name = ? AND REGEXP_LIKE(owner,?,\\'i\\')';\r\n                }\r\n                self.execute(sql, [table, '^' + owner + '$'], function(err, result) {\r\n                    if (err) { callback(err); return; }\r\n                    callback(null, (result[0].count>0));\r\n                });\r\n            },\r\n            /**\r\n             * @param {function(Error,string=)} callback\r\n             */\r\n            version:function(callback) {\r\n                self.execute('SELECT MAX(\"version\") AS \"version\" FROM \"migrations\" WHERE \"appliesTo\"=?',\r\n                    [name], function(err, result) {\r\n                        if (err) { return callback(err); }\r\n                        if (result.length===0)\r\n                            callback(null, '0.0');\r\n                        else\r\n                            callback(null, result[0].version || '0.0');\r\n                    });\r\n            },\r\n            /**\r\n             * @param {function(Error,Boolean=)} callback\r\n             */\r\n            hasSequence:function(callback) {\r\n                callback = callback || function() {};\r\n                let sql;\r\n                if (owner != null) {\r\n                    sql = 'SELECT COUNT(*) AS \"count\" FROM ALL_SEQUENCES WHERE SEQUENCE_NAME=?  AND REGEXP_LIKE(owner,?,\\'i\\')';\r\n                }\r\n                else {\r\n                    sql = 'SELECT COUNT(*) AS \"count\" FROM ALL_SEQUENCES WHERE SEQUENCE_NAME=?';\r\n                }\r\n                self.execute(sql,\r\n                    [ table + '_seq', '^' + (owner || '') + '$' ], function(err, result) {\r\n                        if (err) { callback(err); return; }\r\n                        callback(null, (result[0].count>0));\r\n                    });\r\n            },\r\n            /**\r\n             * @param {function(Error=,Array=)} callback\r\n             */\r\n            columns:function(callback) {\r\n                callback = callback || function() {};\r\n\r\n                /*\r\n                 SELECT c0.COLUMN_NAME AS \"name\", c0.DATA_TYPE AS \"type\", ROWNUM AS \"ordinal\",\r\n                 c0.DATA_LENGTH AS \"size\", c0.DATA_SCALE AS \"scale\", CASE WHEN c0.NULLABLE='Y'\r\n                 THEN 1 ELSE 0 END AS \"nullable\", CASE WHEN t0.CONSTRAINT_TYPE='P' THEN 1 ELSE 0 END AS \"primaryKey\"\r\n                 FROM ALL_TAB_COLUMNS c0 LEFT JOIN (SELECT cols.table_name, cols.column_name, cols.owner, cons.constraint_type\r\n                 FROM all_constraints cons, all_cons_columns cols WHERE cons.constraint_type = 'P'\r\n                 AND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner) t0 ON c0.TABLE_NAME=t0.TABLE_NAME\r\n                 AND c0.OWNER=t0.OWNER AND c0.COLUMN_NAME=t0.COLUMN_NAME WHERE c0.TABLE_NAME = ?\r\n                */\r\n\r\n                let sql =\r\n                    `SELECT c0.COLUMN_NAME AS \"name\", c0.DATA_TYPE AS \"type\", ROWNUM AS \"ordinal\", CASE WHEN c0.\"CHAR_LENGTH\">0 THEN c0.\"CHAR_LENGTH\" ELSE c0.DATA_LENGTH END as \"size\",\r\n                    c0.DATA_SCALE AS \"scale\", c0.DATA_PRECISION AS \"precision\", CASE WHEN c0.NULLABLE='Y' THEN 1 ELSE 0 END AS \"nullable\", CASE WHEN t0.CONSTRAINT_TYPE='P' THEN 1 ELSE 0 END AS \"primary\"\r\n                    FROM ALL_TAB_COLUMNS c0  LEFT JOIN   (\r\n                    SELECT cols.table_name, cols.column_name, cols.owner, cons.constraint_type FROM all_constraints cons INNER JOIN all_cons_columns cols\r\n                    ON cons.constraint_type = 'P' AND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner \r\n                    WHERE cols.table_name=? ) t0 ON c0.COLUMN_NAME=t0.COLUMN_NAME\r\n                    WHERE c0.TABLE_NAME = ?`;\r\n\r\n\r\n                   /* 'SELECT c0.COLUMN_NAME AS \"name\", c0.DATA_TYPE AS \"type\", ROWNUM AS \"ordinal\", CASE WHEN c0.\"CHAR_LENGTH\">0 THEN c0.\"CHAR_LENGTH\" ELSE c0.DATA_LENGTH END as \"size\", ' +\r\n                    'c0.DATA_SCALE AS \"scale\", c0.DATA_PRECISION AS \"precision\", CASE WHEN c0.NULLABLE=\\'Y\\' THEN 1 ELSE 0 END AS \"nullable\", CASE WHEN t0.CONSTRAINT_TYPE=\\'P\\' ' +\r\n                'THEN 1 ELSE 0 END AS \"primary\" FROM ALL_TAB_COLUMNS c0 LEFT JOIN (SELECT cols.table_name, cols.column_name, cols.owner, ' +\r\n                'cons.constraint_type FROM all_constraints cons, all_cons_columns cols WHERE cons.constraint_type = \\'P\\' ' +\r\n                'AND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner) t0 ON c0.TABLE_NAME=t0.TABLE_NAME ' +\r\n                'AND c0.OWNER=t0.OWNER AND c0.COLUMN_NAME=t0.COLUMN_NAME WHERE c0.TABLE_NAME = ?';*/\r\n\r\n\r\n\r\n                if (owner) { \r\n                    sql += ' AND REGEXP_LIKE(c0.OWNER,?,\\'i\\')';\r\n                }\r\n                self.execute(sql, [name,name, '^' + owner + '$'], function(err, result) {\r\n                        if (err) { callback(err); return; }\r\n                        callback(null, result);\r\n                    });\r\n            },\r\n            /**\r\n             * @param {{name:string,type:string,primary:boolean|number,nullable:boolean|number,size:number, scale:number,precision:number,oneToMany:boolean}[]|*} fields\r\n             * @param callback\r\n             */\r\n            create: function(fields, callback) {\r\n                callback = callback || function() {};\r\n                fields = fields || [];\r\n                if (!_.isArray(fields)) {\r\n                    return callback(new Error('Invalid argument type. Expected Array.'));\r\n                }\r\n                if (fields.length === 0) {\r\n                    return callback(new Error('Invalid argument. Fields collection cannot be empty.'));\r\n                }\r\n                let strFields = _.map(\r\n                    _.filter(fields, (x) => {\r\n                        return !x.oneToMany;\r\n                    }),\r\n                    (x) => {\r\n                        return format('\"%f\" %t', x);\r\n                    }).join(', ');\r\n\r\n                //get table qualified name\r\n                let strTable = '';\r\n\r\n                const formatter = new OracleFormatter();\r\n                if (typeof owner !== 'undefined') { strTable = formatter.escapeName(owner) + \".\"; }\r\n                strTable += formatter.escapeName(table);\r\n                //add primary key constraint\r\n                const strPKFields = _.map(_.filter(fields, (x) => {\r\n                        return (x.primary === true || x.primary === 1);\r\n                    }), (x) => {\r\n                        return formatter.escapeName(x.name);\r\n                }).join(', ');\r\n                if (strPKFields.length>0) {\r\n                    strFields += ', ' + util.format('CONSTRAINT \"%s_pk\" PRIMARY KEY (%s)', table, strPKFields);\r\n                }\r\n                const sql = util.format('CREATE TABLE %s (%s)', strTable, strFields);\r\n                self.execute(sql, null, function(err) {\r\n                    callback(err);\r\n                });\r\n            },\r\n            /**\r\n             * Alters the table by adding an array of fields\r\n             * @param {{name:string,type:string,primary:boolean|number,nullable:boolean|number,size:number,oneToMany:boolean}[]|*} fields\r\n             * @param callback\r\n             */\r\n            add:function(fields, callback) {\r\n                callback = callback || function() {};\r\n                fields = fields || [];\r\n                if (!_.isArray(fields)) {\r\n                    //invalid argument exception\r\n                    return callback(new Error('Invalid argument type. Expected Array.'));\r\n                }\r\n                if (fields.length === 0) {\r\n                    //do nothing\r\n                    return callback();\r\n                }\r\n                const strFields = fields.map(function(x) {\r\n                    return format('\"%f\" %t', x);\r\n                }).join(', ');\r\n\r\n                //get table qualified name\r\n                let strTable = '';\r\n\r\n                const formatter = new OracleFormatter();\r\n                if (typeof owner !== 'undefined') { strTable = formatter.escapeName(owner) + \".\"; }\r\n                strTable += formatter.escapeName(table);\r\n                //generate SQL statement\r\n                const sql = util.format('ALTER TABLE %s ADD (%s)', strTable, strFields);\r\n                self.execute(sql, [], function(err) {\r\n                    callback(err);\r\n                });\r\n            },\r\n            /**\r\n             * Alters the table by modifying an array of fields\r\n             * @param {{name:string,type:string,primary:boolean|number,nullable:boolean|number,size:number,oneToMany:boolean}[]|*} fields\r\n             * @param callback\r\n             */\r\n            change:function(fields, callback) {\r\n                callback = callback || function() {};\r\n                fields = fields || [];\r\n                if (!_.isArray(fields)) {\r\n                    //invalid argument exception\r\n                    return callback(new Error('Invalid argument type. Expected Array.'));\r\n                }\r\n                if (fields.length === 0) {\r\n                    //do nothing\r\n                    return callback();\r\n                }\r\n\r\n                //get columns\r\n                return this.columns((err, columns)=> {\r\n                    if (err) {\r\n                        return callback(err);\r\n                    }\r\n\r\n                    const strFields = fields.map(function(x) {\r\n                        let column = columns.find((y)=> {\r\n                            return y.name === x.name;\r\n                        });\r\n                        let res = format('\"%f\" %t', x);\r\n                        if (column && (LangUtils.parseBoolean((typeof x.nullable === 'undefined') ? true : x.nullable) === LangUtils.parseBoolean(column.nullable))) {\r\n                            res = res.replace(/\\sNOT\\sNULL$/,'').replace(/\\sNULL$/,'');\r\n                        }\r\n                        return res;\r\n                    }).join(', ');\r\n\r\n                    //get table qualified name\r\n                    let strTable = '';\r\n\r\n                    const formatter = new OracleFormatter();\r\n                    if (typeof owner !== 'undefined') { strTable = formatter.escapeName(owner) + \".\"; }\r\n                    strTable += formatter.escapeName(table);\r\n                    //generate SQL statement\r\n                    const sql = util.format('ALTER TABLE %s MODIFY (%s)', strTable, strFields);\r\n                    self.execute(sql, [], function(err) {\r\n                        callback(err);\r\n                    });\r\n\r\n                });\r\n\r\n\r\n            }\r\n        };\r\n    }\r\n\r\n    view(name) {\r\n        const self = this;\r\n        let owner;\r\n        let view;\r\n\r\n        const matches = /(\\w+)\\.(\\w+)/.exec(name);\r\n        if (matches) {\r\n            //get schema owner\r\n            owner = matches[1];\r\n            //get table name\r\n            view = matches[2];\r\n        }\r\n        else {\r\n            view = name;\r\n            //get schema name (from options)\r\n            if (self.options && self.options.schema) {\r\n                owner = self.options.schema;\r\n            }\r\n        }\r\n        return {\r\n            /**\r\n             * @param {function(Error,Boolean=)} callback\r\n             */\r\n            exists:function(callback) {\r\n                let sql = 'SELECT COUNT(*) AS \"count\" FROM ALL_OBJECTS WHERE object_type IN (\\'VIEW\\') AND object_name = ?';\r\n                if (owner != null) {\r\n                    sql += ' AND REGEXP_LIKE(owner,?,\\'i\\')';\r\n                }\r\n                self.execute(sql, [name, '^' + (owner || '') + '$'], function(err, result) {\r\n                    if (err) { callback(err); return; }\r\n                    callback(null, (result[0].count>0));\r\n                });\r\n            },\r\n            /**\r\n             * @param {function(Error=)} callback\r\n             */\r\n            drop:function(callback) {\r\n                callback = callback || function() {};\r\n                self.open(function(err) {\r\n                   if (err) { return callback(err); }\r\n\r\n                    let sql = 'SELECT COUNT(*) AS \"count\" FROM ALL_OBJECTS WHERE object_type IN (\\'VIEW\\') AND object_name = ?';\r\n                    if (typeof owner !== 'undefined') {\r\n                        sql += ' AND REGEXP_LIKE(owner,?,\\'i\\')';\r\n                    }\r\n                    self.execute(sql, [name, '^' + (owner || '') + '$'], function(err, result) {\r\n                        if (err) { return callback(err); }\r\n                        const exists = (result[0].count>0);\r\n                        if (exists) {\r\n                            const sql = util.format('DROP VIEW \"%s\"', name);\r\n                            self.execute(sql, undefined, function(err) {\r\n                                if (err) { callback(err); return; }\r\n                                callback();\r\n                            });\r\n                        }\r\n                        else {\r\n                            callback();\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n            /**\r\n             * @param {QueryExpression|*} q\r\n             * @param {function(Error=)} callback\r\n             */\r\n            create:function(q, callback) {\r\n                const thisArg = this;\r\n                self.executeInTransaction(function(tr) {\r\n                    thisArg.drop(function(err) {\r\n                        if (err) { tr(err); return; }\r\n                        try {\r\n                            let sql = util.format('CREATE VIEW \"%s\" AS ', name);\r\n                            const formatter = new OracleFormatter();\r\n                            sql += formatter.format(q);\r\n                            self.execute(sql, [], tr);\r\n                        }\r\n                        catch(e) {\r\n                            tr(e);\r\n                        }\r\n                    });\r\n                }, function(err) {\r\n                    callback(err);\r\n                });\r\n\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Executes a query against the underlying database\r\n     * @param query {QueryExpression|string|*}\r\n     * @param values {*=}\r\n     * @param {function(Error=,*=)} callback\r\n     */\r\n    execute(query, values, callback) {\r\n        const self = this;\r\n        let sql = null;\r\n        try {\r\n\r\n            if (typeof query === 'string') {\r\n                //get raw sql statement\r\n                sql = query;\r\n            }\r\n            else {\r\n                //format query expression or any object that may be act as query expression\r\n                const formatter = new OracleFormatter();\r\n                sql = formatter.format(query);\r\n            }\r\n            //validate sql statement\r\n            if (typeof sql !== 'string') {\r\n                callback.call(self, new Error('The executing command is of the wrong type or empty.'));\r\n                return;\r\n            }\r\n            //ensure connection\r\n            self.open(function(err) {\r\n                if (err) {\r\n                    callback.call(self, err);\r\n                }\r\n                else {\r\n                    //log statement (optional)\r\n                    if (process.env.NODE_ENV==='development')\r\n                        TraceUtils.log(util.format('SQL:%s, Parameters:%s', sql, JSON.stringify(values)));\r\n                    //prepare statement - the traditional way\r\n                    const prepared = self.prepare(sql, values);\r\n                    //execute raw command\r\n                    self.rawConnection.execute(prepared,[], {outFormat: oracledb.OBJECT, autoCommit: (typeof self.transaction === 'undefined') }, function(err, result) {\r\n                        if (err) {\r\n                            //log sql\r\n                            TraceUtils.log(util.format('SQL Error:%s', prepared));\r\n                            callback(err);\r\n                        }\r\n                        else {\r\n                            if (result)\r\n                                callback(null, result.rows);\r\n                            else\r\n                                callback();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        catch (e) {\r\n            callback.call(self, e);\r\n        }\r\n    }\r\n}\r\n\r\nfunction zeroPad(number, length) {\r\n    number = number || 0;\r\n    let res = number.toString();\r\n    while (res.length < length) {\r\n        res = '0' + res;\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * @class\r\n * @augments {SqlFormatter}\r\n */\r\nexport class OracleFormatter extends SqlFormatter {\r\n    /**\r\n     * @constructor\r\n     */\r\n    constructor() {\r\n        super();\r\n        this.settings = {\r\n            nameFormat:OracleFormatter.NAME_FORMAT,\r\n            forceAlias:true,\r\n            useAliasKeyword: false\r\n        };\r\n    }\r\n\r\n    escapeName(name) {\r\n        if (typeof name === 'string')\r\n            return name.replace(/(\\w+)/ig, this.settings.nameFormat);\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * Escapes an object or a value and returns the equivalent sql value.\r\n     * @param {*} value - A value that is going to be escaped for SQL statements\r\n     * @param {boolean=} unquoted - An optional value that indicates whether the resulted string will be quoted or not.\r\n     * returns {string} - The equivalent SQL string value\r\n     */\r\n    escape(value, unquoted) {\r\n        if (typeof value === 'boolean') { return value ? '1' : '0'; }\r\n        if (value instanceof Date) {\r\n            return util.format('TO_TIMESTAMP_TZ(%s, \\'YYYY-MM-DD HH24:MI:SS.FF3TZH:TZM\\')', this.escapeDate(value));\r\n        }\r\n        if (typeof value === 'string' && LangUtils.isDate(value)) {\r\n            return util.format('TO_TIMESTAMP_TZ(%s, \\'YYYY-MM-DD HH24:MI:SS.FF3TZH:TZM\\')', this.escapeDate(new Date(value)));\r\n        }\r\n        let res = super.escape.bind(this)(value, unquoted);\r\n        if (typeof value === 'string') {\r\n            if (/\\\\'/g.test(res)) {\r\n                //escape single quote (that is already escaped)\r\n                res = res.replace(/\\\\'/g, SINGLE_QUOTE_ESCAPE);\r\n                if (/\\\\\"/g.test(res))\r\n                //escape double quote (that is already escaped)\r\n                    res = res.replace(/\\\\\"/g, DOUBLE_QUOTE_ESCAPE);\r\n                if (/\\\\\\\\/g.test(res))\r\n                //escape slash (that is already escaped)\r\n                    res = res.replace(/\\\\\\\\/g, SLASH_ESCAPE);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * @param {Date|*} val\r\n     * @returns {string}\r\n     */\r\n    escapeDate(val) {\r\n        const year   = val.getFullYear();\r\n        const month  = zeroPad(val.getMonth() + 1, 2);\r\n        const day    = zeroPad(val.getDate(), 2);\r\n        const hour   = zeroPad(val.getHours(), 2);\r\n        const minute = zeroPad(val.getMinutes(), 2);\r\n        const second = zeroPad(val.getSeconds(), 2);\r\n        //var millisecond = zeroPad(dt.getMilliseconds(), 3);\r\n        //format timezone\r\n        const offset = (new Date()).getTimezoneOffset(), timezone = (offset<=0 ? '+' : '-') + zeroPad(-Math.floor(offset/60),2) + ':' + zeroPad(offset%60,2);\r\n        return \"'\" + year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second + \".\" + zeroPad(val.getMilliseconds(), 3) + timezone + \"'\";\r\n    }\r\n\r\n\r\n    /**\r\n     * Formats a fixed query expression where select fields are constants e.g. SELECT 1 AS `id`,'John' AS `givenName` etc\r\n     * @param obj {QueryExpression|*}\r\n     * @returns {string}\r\n     */\r\n    formatFixedSelect(obj) {\r\n        let self = this;\r\n        let fields = obj.fields();\r\n        return 'SELECT ' + _.map(fields, function(x) { return self.format(x,'%f'); }).join(', ') + ' FROM DUAL';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {QueryExpression} obj\r\n     * @returns {string}\r\n     */\r\n    formatLimitSelect(obj) {\r\n\r\n        let sql;\r\n        const self=this;\r\n        let take = parseInt(obj.$take) || 0;\r\n        let skip = parseInt(obj.$skip) || 0;\r\n        if (take<=0) {\r\n            sql=self.formatSelect(obj);\r\n        }\r\n        else {\r\n            //add row_number with order\r\n            const keys = Object.keys(obj.$select);\r\n            if (keys.length === 0)\r\n                throw new Error('Entity is missing');\r\n            //get select fields\r\n            let selectFields = obj.$select[keys[0]];\r\n            //get order\r\n            let order = obj.$order;\r\n            //add row index field\r\n            selectFields.push({\r\n                \"__RowIndex\": {\r\n                  $row_index: order\r\n                }\r\n            });\r\n            //remove order\r\n            if (order) {\r\n                delete obj.$order;\r\n            }\r\n            //get sub query\r\n            const subQuery = self.formatSelect(obj);\r\n            //add order again\r\n            if (order) {\r\n                obj.$order = order;\r\n            }\r\n            //remove row index field\r\n            selectFields.pop();\r\n            const fields = [];\r\n            _.forEach(selectFields, (x) => {\r\n                if (typeof x === 'string') {\r\n                    fields.push(new QueryField(x));\r\n                }\r\n                else {\r\n                    /**\r\n                     * @type QueryField\r\n                     */\r\n                    let field = Object.assign(new QueryField(), x);\r\n                    fields.push(field.as() || field.getName());\r\n                }\r\n            });\r\n            sql = util.format('SELECT %s FROM (%s) t0 WHERE \"__RowIndex\" BETWEEN %s AND %s', _.map(fields, (x) => {\r\n                return self.format(x, '%f');\r\n            }).join(', '), subQuery, skip + 1, skip + take);\r\n        }\r\n        return sql;\r\n\r\n    }\r\n    /**\r\n     * Implements [a & b] bitwise and expression formatter.\r\n     * @param p0 {*}\r\n     * @param p1 {*}\r\n     */\r\n    $bit(p0, p1)\r\n    {\r\n        return util.format('BITAND(%s, %s)', this.escape(p0), this.escape(p1));\r\n    }\r\n\r\n    /**\r\n     * Implements indexOf(str,substr) expression formatter.\r\n     * @param {string} p0 The source string\r\n     * @param {string} p1 The string to search for\r\n     * @returns {string}\r\n     */\r\n    $indexof(p0, p1) {\r\n        return util.format('(INSTR(%s,%s)-1)', this.escape(p0), this.escape(p1));\r\n    }\r\n\r\n    /**\r\n     * Implements contains(a,b) expression formatter.\r\n     * @param {string} p0 The source string\r\n     * @param {string} p1 The string to search for\r\n     * @returns {string}\r\n     */\r\n    $text(p0, p1) {\r\n        return util.format('(INSTR(%s,%s)-1)>=0', this.escape(p0), this.escape(p1));\r\n    }\r\n\r\n    /**\r\n     * Implements concat(a,b) expression formatter.\r\n     * @param {*} p0\r\n     * @param {*} p1\r\n     * @returns {string}\r\n     */\r\n    $concat(p0, p1) {\r\n        return util.format('CONCAT(%s,%s)', this.escape(p0),  this.escape(p1));\r\n    }\r\n\r\n    /**\r\n     * Implements substring(str,pos) expression formatter.\r\n     * @param {String} p0 The source string\r\n     * @param {Number} pos The starting position\r\n     * @param {Number=} length The length of the resulted string\r\n     * @returns {string}\r\n     */\r\n    $substring(p0, pos, length) {\r\n        if (length)\r\n            return util.format('SUBSTR(%s,%s,%s)', this.escape(p0), pos.valueOf()+1, length.valueOf());\r\n        else\r\n            return util.format('SUBSTR(%s,%s)', this.escape(p0), pos.valueOf()+1);\r\n    }\r\n\r\n    /**\r\n     * Implements length(a) expression formatter.\r\n     * @param {*} p0\r\n     * @returns {string}\r\n     */\r\n    $length(p0) {\r\n        return util.format('LENGTH(%s)', this.escape(p0));\r\n    }\r\n\r\n    /**\r\n     * @param {...*} p0\r\n     * @return {*}\r\n     */\r\n    $row_index(p0) {\r\n        let args = Array.prototype.slice.call(arguments);\r\n        return util.format('ROW_NUMBER() OVER(%s)', (args && args.length) ? this.format(args, '%o') : 'ORDER BY NULL');\r\n    }\r\n\r\n    $ceiling(p0) {\r\n        return util.format('CEIL(%s)', this.escape(p0));\r\n    }\r\n\r\n    $startswith(p0, p1) {\r\n        //validate params\r\n        if ( _.isNil(p0) ||  _.isNil(p1))\r\n            return '';\r\n        return 'REGEXP_COUNT(' + this.escape(p0) + ',\\'^' + this.escape(p1, true) + '\\', 1, \\'i\\')';\r\n    }\r\n\r\n    $contains(p0, p1) {\r\n        //validate params\r\n        if ( _.isNil(p0) ||  _.isNil(p1))\r\n            return '';\r\n        //(CASE WHEN REGEXP_COUNT(x, 'text', 1, 'i') > 0 THEN 1 ELSE 0 END)\r\n        return '(CASE WHEN REGEXP_COUNT(' + this.escape(p0) + ',\\'' + this.escape(p1, true) + '\\', 1, \\'i\\') > 0 THEN 1 ELSE 0 END)';\r\n    }\r\n\r\n    $endswith(p0, p1) {\r\n        //validate params\r\n        if ( _.isNil(p0) ||  _.isNil(p1))\r\n            return '';\r\n        return 'REGEXP_COUNT(' + this.escape(p0) + ',\\'' + this.escape(p1, true) + '$\\', 1, \\'i\\')';\r\n    }\r\n\r\n    $day(p0) {\r\n        return util.format('EXTRACT(DAY FROM %s)', this.escape(p0)) ;\r\n    }\r\n\r\n    $month(p0) {\r\n        return util.format('EXTRACT(MONTH FROM %s)', this.escape(p0)) ;\r\n    }\r\n\r\n    $year(p0) {\r\n        return util.format('EXTRACT(YEAR FROM %s)', this.escape(p0)) ;\r\n    }\r\n\r\n    $hour(p0) {\r\n        return util.format('EXTRACT(HOUR FROM %s)', this.escape(p0)) ;\r\n    }\r\n\r\n    $minute(p0) {\r\n        return util.format('EXTRACT(MINUTE FROM %s)', this.escape(p0)) ;\r\n    }\r\n\r\n    $second(p0) {\r\n        return util.format('EXTRACT(SECOND FROM %s)', this.escape(p0)) ;\r\n    }\r\n\r\n    $date(p0) {\r\n        //alternative date solution: 'TO_TIMESTAMP_TZ(TO_CHAR(%s, 'YYYY-MM-DD'),'YYYY-MM-DD')'\r\n        return util.format('TRUNC(%s)', this.escape(p0)) ;\r\n    }\r\n\r\n    /**\r\n     * Implements contains(a,b) expression formatter.\r\n     * @param {*} p0 The source string\r\n     * @param {string|*} p1 The string to search for\r\n     * @returns {string}\r\n     */\r\n    $regex(p0, p1) {\r\n        //validate params\r\n        if ( _.isNil(p0) ||  _.isNil(p1))\r\n            return '';\r\n        return 'REGEXP_LIKE(' + this.escape(p0) + ',\\'' + this.escape(p1, true) + '\\')';\r\n    }\r\n}\r\n\r\nOracleFormatter.NAME_FORMAT = '\"$1\"';\r\n\r\nconst SINGLE_QUOTE_ESCAPE = '\\'\\'';\r\nconst DOUBLE_QUOTE_ESCAPE = '\"';\r\nconst SLASH_ESCAPE = '\\\\';\r\n\r\n/**\r\n * Creates an instance of OracleAdapter object that represents an Oracle database connection.\r\n * @param {*} options An object that represents the properties of the underlying database connection.\r\n * @returns {DataAdapter|*}\r\n */\r\nexport function createInstance(options) {\r\n    return new OracleAdapter(options);\r\n}\r\n"]}